{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\Game.js"],"names":["Player","require","cc","Class","extends","Component","properties","majiangPrefab","default","type","Prefab","playerPrefab","playerEntities","takeoutIndex","takeoutScale","initScale","majiangWidth","majiangHeight","majiangJianxi","basicTakeoutY","numbers","btnReady","Button","btnGetOne","btnJoinOne","btnNewReady","duiziCount","duiziWidth","duiziScale","duimianMjScale","duimianMjWidth","isSingle","majiangIndex","currentMajiang","hasNewMajiang","shouliList","duiziList","angangList","minggangList","players","onLoad","console","log","initDefaultNumber","userId","user","uid","nickname","avatar","user2","user3","push","initUserPosition","node","on","beginEvent","testBeginMopai","testJoinPeople","testNewBegin","start","update","dt","width","Math","floor","height","originX","originY","majiangAllWidth","testGetRandomNumbers","initAllMajiang","initDownStairsMjs","mopai","mjzz","mj","spawnNewMj","getComponent","setPosition","playerNewMjPositionList","addChild","index","getPlayerIndexByUid","pos","initCount","nubArr","i","ent","length","updateShoulipai","huase","number","instantiate","config","game","setScale","spawnNewOtherMj","getNewMjPosition","isNewOne","randX","randY","v2","getTakeOutPosition","scaleWidth","outNumb","outLevel","parseInt","mjX","mjY","removeShoulipai","shouli","forEach","value","ind","bind","getOther","newList","aw","getAW","sort","a","b","testGetOne","duigangWidth","unSelectOthers","isSelected","unSelect","spawnNewPlayer","player","playerEntity","userinfo","setOtherTakeOutPosition","myPositionIndex","initAvatarPositions","initFixedMjPositions","mine","mine_new","add","downstairs","downstairs_new","duimianMjAllWidth","opposite","opposite_new","upstairs","upstairs_new","playerFixedMjPositionList","aWidth","aHeight","padding","avatarPositionList","joinAllPeople","joinNewPeople","posIndex","getPlayerPositionIndex","userIndex","getPlayerPosition","arr","se","ds","amount","random","LeadSeat","getChildByName","ShowMjNode","NewMjNode","CurrentMj","getOne","setTimeout","enabled","DustbinNode","Dustbin","CardNode","card","initCardInfo","NewMj","CurrentMjNode","dustbin","initAllCurrentMj"],"mappings":";;;;;;;;;;AAAA;;;AAGA,IAAMA,SAASC,QAAQ,QAAR,CAAf;AACAC,GAAGC,KAAH,CAAS;AACRC,UAASF,GAAGG,SADJ;;AAGRC;AACC;AACAC,iBAAe;AACdC,YAAS,IADK;AAEdC,SAAMP,GAAGQ;AAFK,GAFhB;AAMC;AACAC,gBAAc;AACbH,YAAS,IADI;AAEbC,SAAMP,GAAGQ;AAFI,GAPf;;AAcCE,kBAAe;AACdJ,YAAQ,EADM;AAEdC,SAAKT;AAFS,GAdhB;AAkBC;AACAa,gBAAc,CAnBf;AAoBC;AACAC,gBAAc,CArBf;AAsBC;AACAC,aAAW,IAvBZ;AAwBC;AACAC,gBAAc,EAzBf;AA0BC;AACAC,iBAAe,EA3BhB;AA4BC;AACAC,iBAAe,CA7BhB;AA8BC;AACAC,iBAAe,CA/BhB;AAgCC;AACAC,WAAS,EAjCV;AAkCC;AACAC,YAAUnB,GAAGoB,MAnCd;AAoCC;AACAC,aAAWrB,GAAGoB,MArCf;AAsCC;AACAE,cAAYtB,GAAGoB,MAvChB;AAwCC;AACAG,eAAavB,GAAGoB,MAzCjB;AA0CC;AACAI,cAAY,CA3Cb;AA4CC;AACAC,cAAY,CA7Cb;AA8CC;AACAC,cAAY,CA/Cb;AAgDC;AACAC,kBAAgB,CAjDjB;AAkDC;AACAC,kBAAgB,EAnDjB;AAoDC;AACAC,YAAU,IArDX;AAsDC;AACAC,gBAAc,CAvDf;AAwDC;AACAC,kBAAgB,IAzDjB;AA0DC;AACAC,iBAAc,KA3Df;AA4DC;AACAC,cAAY,EA7Db;AA8DC;AACAC,aAAW,EA/DZ;AAgEC;AACAC,cAAY,EAjEb;AAkEC;AACAC,gBAAc,EAnEf;AAoEC;AACAC,WAAS;AArEV,mDAsEgB,IAtEhB,0CAwES,CAxET,mDA0EkB,CA1ElB,eAHQ;;AAgFR;;AAEAC,OAlFQ,oBAkFC;AACRC,UAAQC,GAAR,CAAY,YAAZ;AACA;AACA;AACA,OAAKC,iBAAL;AACA;AACA,OAAKC,MAAL,GAAc,KAAd;AACA;AACA,MAAIC,OAAO;AACVC,QAAK,KADK;AAEVC,aAAU,SAFA;AAGVC,WAAQ;AAHE,GAAX;AAKA,MAAIC,QAAQ;AACXH,QAAK,KADM;AAEXC,aAAU,SAFC;AAGXC,WAAQ;AAHG,GAAZ;AAKA,MAAIE,QAAQ;AACXJ,QAAK,KADM;AAEXC,aAAU,SAFC;AAGXC,WAAQ;AAHG,GAAZ;AAKA,OAAKT,OAAL,CAAaY,IAAb,CAAkBN,IAAlB;AACA,OAAKN,OAAL,CAAaY,IAAb,CAAkBF,KAAlB;AACA,OAAKV,OAAL,CAAaY,IAAb,CAAkBD,KAAlB;AACAT,UAAQC,GAAR,CAAY,KAAKH,OAAjB;AACA;AACA,OAAKa,gBAAL;AACA;AACA;;AAEA;AACA,OAAK/B,QAAL,CAAcgC,IAAd,CAAmBC,EAAnB,CAAsB,OAAtB,EAA+B,KAAKC,UAApC,EAAgD,IAAhD;AACA;AACA,OAAKhC,SAAL,CAAe8B,IAAf,CAAoBC,EAApB,CAAuB,OAAvB,EAAgC,KAAKE,cAArC,EAAqD,IAArD;AACA,OAAKhC,UAAL,CAAgB6B,IAAhB,CAAqBC,EAArB,CAAwB,OAAxB,EAAiC,KAAKG,cAAtC,EAAsD,IAAtD;AACA;AACA,OAAKhC,WAAL,CAAiB4B,IAAjB,CAAsBC,EAAtB,CAAyB,OAAzB,EAAiC,KAAKI,YAAtC,EAAmD,IAAnD;AACA,EAzHO;AA2HRC,MA3HQ,mBA2HA,CAEP,CA7HO;AA+HRC,OA/HQ,kBA+HDC,EA/HC,EA+HG;AACV;AACA,EAjIO;;AAkIR;AACAlB,oBAAkB,6BAAU;AAC3B,MAAImB,QAAQC,KAAKC,KAAL,CAAW,KAAKX,IAAL,CAAUS,KAArB,CAAZ;AACA,MAAIG,SAASF,KAAKC,KAAL,CAAW,KAAKX,IAAL,CAAUY,MAArB,CAAb;AACA;AACA,OAAKC,OAAL,GAAe,CAACJ,KAAD,GAAS,CAAxB;AACA,OAAKK,OAAL,GAAe,CAACF,MAAD,GAAU,CAAzB;AACA,OAAK9C,aAAL,GAAqB,KAAKgD,OAAL,GAAe,KAAKlD,aAAL,GAAqB,KAAKF,SAAzC,GAAqD,EAA1E;AACA0B,UAAQC,GAAR,CAAYoB,KAAZ,EAAmBG,MAAnB;AACA;AACA,OAAKG,eAAL,GAAuB,CAAC,KAAKpD,YAAL,GAAoB,KAAKD,SAAzB,GAAqC,KAAKG,aAA3C,IAA4D,EAAnF;AACA;AACA,OAAKS,UAAL,GAAkB,CAAC,KAAKX,YAAL,GAAoB,KAAKE,aAA1B,IAA2C,CAA3C,GAA+C,KAAKU,UAAtE;AACA,EA/IO;AAgJR;AACA2B,aAAY,sBAAW;AACtBd,UAAQC,GAAR,CAAY,SAAZ;AACA;AACA;AACA,OAAK2B,oBAAL;AACA;AACA,OAAKC,cAAL;AACA;AACA,OAAKC,iBAAL;AACA,EA1JO;AA2JRC,QAAO,eAAS1B,GAAT,EAAa2B,IAAb,EAAmB;AACzBhC,UAAQC,GAAR,CAAY,KAAZ,EAAkBI,GAAlB,EAAsB,IAAtB,EAA2B2B,IAA3B;AACA;AACA,MAAG3B,OAAO,KAAKF,MAAf,EAAsB;AACrB,OAAI8B,KAAK,KAAKC,UAAL,CAAgBF,IAAhB,CAAT;AACA,QAAKvC,aAAL,GAAmB,IAAnB;AACA,QAAKD,cAAL,GAAsByC,GAAGE,YAAH,CAAgB,eAAhB,CAAtB;;AAEA;AACA;AACA;AACAF,MAAGG,WAAH,CAAe,KAAKC,uBAAL,CAA6B,CAA7B,CAAf;AACA,QAAKzB,IAAL,CAAU0B,QAAV,CAAmBL,EAAnB;AACA,GAVD,MAUK;AACJ;AACA,OAAIM,QAAQ,KAAKC,mBAAL,CAAyBnC,GAAzB,CAAZ;AACA;AACA,OAAIoC,MAAM,KAAKJ,uBAAL,CAA6BE,KAA7B,CAAV;AAEA;AACD,EA/KO;;AAiLRV,iBAAgB,0BAAW;AAC1B,MAAIa,YAAY,EAAhB;AACA,MAAIC,SAAS,EAAb;AACA,OAAI,IAAIC,IAAI,CAAZ,EAAeA,IAAIF,SAAnB,EAA8B,EAAEE,CAAhC,EAAmC;AAClC,OAAIC,MAAM,KAAKlE,OAAL,CAAaiE,CAAb,CAAV;AACAD,UAAOjC,IAAP,CAAYmC,GAAZ;AACA,QAAKtD,YAAL;AACA;AACDS,UAAQC,GAAR,CAAY0C,MAAZ;AACA,OAAI,IAAIC,KAAI,CAAZ,EAAeA,KAAID,OAAOG,MAA1B,EAAkC,EAAEF,EAApC,EAAuC;AACtC,OAAIZ,OAAOW,OAAOC,EAAP,CAAX;AACA;AACA,OAAIX,KAAK,KAAKC,UAAL,CAAgBF,IAAhB,CAAT;AACA;AACA,QAAKpB,IAAL,CAAU0B,QAAV,CAAmBL,EAAnB;AACA;AACD;AACA;AACA;AACA,OAAKc,eAAL;AACA;AACA,EAtMO;AAuMR;AACAb,aAAY,oBAASF,IAAT,EAAe;AAC1BhC,UAAQC,GAAR,CAAY,OAAZ,EAAqB+B,KAAKgB,KAA1B,EAAiChB,KAAKiB,MAAtC;AACA,MAAIhB,KAAKxE,GAAGyF,WAAH,CAAe,KAAKpF,aAApB,CAAT;AACA,MAAIqF,SAASlB,GAAGE,YAAH,CAAgB,eAAhB,CAAb;AACAgB,SAAOC,IAAP,GAAc,IAAd;AACAD,SAAOH,KAAP,GAAehB,KAAKgB,KAApB;AACAG,SAAOF,MAAP,GAAgBjB,KAAKiB,MAArB;AACAE,SAAOZ,KAAP,GAAeP,KAAKO,KAApB;AACAN,KAAGoB,QAAH,CAAY,KAAK/E,SAAjB;AACA;AACA,OAAKoB,UAAL,CAAgBgB,IAAhB,CAAqByC,MAArB;AACA,SAAOlB,EAAP;AACA,EApNO;AAqNR;AACAqB,kBAAgB,yBAASb,GAAT,EAAa;AAC5B;AACA,EAxNO;AAyNR;AACAc,mBAAkB,0BAAShB,KAAT,EAAgBiB,QAAhB,EAA0BtC,KAA1B,EAAiC;AAClD;AACA,MAAIuC,QAAQvC,QAAQ,KAAKS,eAAL,GAAuB,CAA/B,GAAoCY,KAAD,IAAW,KAAKhE,YAAL,GAAoB,KAAKD,SAAzB,GAAqC,KAAKG,aAArD,CAA/C;AACA,MAAIiF,QAAQ,KAAKhC,OAAL,GAAe,EAA3B,CAHkD,CAGnB;AAC/B;AACA,MAAG8B,QAAH,EAAa;AACZC,WAAQA,QAAQ,EAAhB;AACAzD,WAAQC,GAAR,CAAY,OAAZ,EAAqBsC,KAArB,EAA4BkB,KAA5B,EAAmCC,KAAnC;AACA;AACD,SAAOjG,GAAGkG,EAAH,CAAMF,KAAN,EAAaC,KAAb,CAAP;AACA,EApOO;AAqORE,qBAAoB,4BAAShD,IAAT,EAAe;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAIiD,aAAa,CAAC,KAAKtF,YAAL,GAAoB,KAAKE,aAA1B,IAA2C,KAAKJ,YAAjE;AACA,MAAIyF,UAAU,EAAd;AACA;AACA,MAAIC,WAAWC,SAAS,KAAK5F,YAAL,GAAoB0F,OAA7B,CAAf;AACA;AACA;AACA,MAAIG,MAAM,CAACH,OAAD,GAAWD,UAAX,GAAwB,CAAxB,GAA6BA,cAAc,KAAKzF,YAAL,GAAoB2F,WAAWD,OAA7C,CAAvC;;AAEA,MAAII,MAAM,KAAKxF,aAAL,GAAqBqF,YAAY,KAAKvF,aAAL,GAAqB,KAAKH,YAAtC,CAA/B;AACA,OAAKD,YAAL;AACA4B,UAAQC,GAAR,CAAY,QAAZ,EAAsB8D,QAAtB,EAAgCE,GAAhC,EAAqCC,GAArC;AACA;AACA,SAAOzG,GAAGkG,EAAH,CAAMM,GAAN,EAAWC,GAAX,CAAP;AACA,EA3PO;AA4PR;AACAC,kBAAgB,yBAAStB,GAAT,EAAa;AAC5B,MAAIuB,SAAO,EAAX;AACA,OAAK1E,UAAL,CAAgB2E,OAAhB,CAAwB,UAASC,KAAT,EAAgBC,GAAhB,EAAqB;AAC5C,OAAGD,MAAM/B,KAAN,IAAeM,IAAIN,KAAtB,EAA4B;AAC3B6B,WAAO1D,IAAP,CAAY4D,KAAZ;AACA;AACD,GAJuB,CAItBE,IAJsB,CAIjB,IAJiB,CAAxB;AAKA,OAAK9E,UAAL,GAAgB0E,MAAhB;AACA,OAAKrB,eAAL,CAAqB,IAArB;AACA,EAtQO;AAuQR;AACAA,kBAAiB,yBAAS0B,QAAT,EAAmB;AACnC;AACA,MAAIC,UAAU,EAAd;AACA;AACA,MAAIC,KAAK,KAAKC,KAAL,EAAT;AACA,MAAIrC,QAAQ,CAAZ;AACA;AACA,OAAK7C,UAAL,CAAgBmF,IAAhB,CAAqB,UAASC,CAAT,EAAYC,CAAZ,EAAe;AACnC,UAAOD,EAAEvC,KAAF,GAAUwC,EAAExC,KAAnB;AACA,GAFD;AAGA;AACA,OAAK7C,UAAL,CAAgB2E,OAAhB,CAAwB,UAASC,KAAT,EAAgBC,GAAhB,EAAqB;AAC5CD,SAAM1D,IAAN,CAAWwB,WAAX,CAAuB,KAAKmB,gBAAL,CAAsBgB,GAAtB,EAA2B,KAA3B,EAAkCI,EAAlC,CAAvB;AACA,GAFuB,CAEtBH,IAFsB,CAEjB,IAFiB,CAAxB;AAGA;AACM,OAAK/E,aAAL,GAAmB,KAAnB;AACA,MAAGgF,QAAH,EAAY;AACX;AACA,QAAKO,UAAL;AACA;AACP,EA5RO;AA6RR;AACAJ,QAAO,iBAAW;AACjB,MAAIK,eAAe,KAAK/F,UAAxB;AACA,MAAIyF,KAAK,CAAC,KAAKhF,SAAL,CAAemD,MAAf,GAAwB,KAAKlD,UAAL,CAAgBkD,MAAxC,GAAiD,KAAKjD,YAAL,CAAkBiD,MAApE,KAA+EmC,eAAe,EAA9F,IAAoG,EAA7G;AACA,SAAON,EAAP;AACA,EAlSO;AAmSR;AACAO,iBAAgB,wBAASrC,GAAT,EAAc;AAC7B;AACA,MAAG,KAAKvD,QAAR,EAAkB;AACjB,QAAKI,UAAL,CAAgB2E,OAAhB,CAAwB,UAASC,KAAT,EAAgBC,GAAhB,EAAqB;AAC5C,QAAGD,MAAM/B,KAAN,IAAeM,IAAIN,KAAnB,IAA4B+B,MAAMa,UAArC,EAAiD;AAChDb,WAAMc,QAAN;AACA;AACD,IAJD;AAKA;AACD,EA7SO;AA8SR;AACAC,iBAAgB,wBAASC,MAAT,EAAiB;AAChCtF,UAAQC,GAAR,CAAY,OAAZ,EAAqBqF,OAAOjF,GAA5B,EAAiCiF,OAAOhF,QAAxC,EAAkDgF,OAAO/E,MAAzD;AACA,MAAIgF,eAAe9H,GAAGyF,WAAH,CAAe,KAAKhF,YAApB,CAAnB;AACA,MAAIiF,SAASoC,aAAapD,YAAb,CAA0B,QAA1B,CAAb;AACAgB,SAAOC,IAAP,GAAc,IAAd;AACAD,SAAOqC,QAAP,GAAgBF,MAAhB;AACA;AACA,OAAKnH,cAAL,CAAoBmH,OAAOjF,GAA3B,IAAgC8C,MAAhC;AACA,SAAOoC,YAAP;AACA,EAxTO;AAyTR;AACAE,0BAAyB,mCAAW,CAEnC,CA5TO;AA6TR;AACA9E,mBAAkB,4BAAW;AAC5B;AACA,OAAKb,OAAL,CAAauE,OAAb,CAAqB,UAASC,KAAT,EAAgB/B,KAAhB,EAAuB;AAC3C,OAAG+B,MAAMjE,GAAN,IAAa,KAAKF,MAArB,EAA6B;AAC5B,SAAKuF,eAAL,GAAuBnD,KAAvB;AACA;AACD,GAJoB,CAInBiC,IAJmB,CAId,IAJc,CAArB;AAKA;AACA,OAAKmB,mBAAL;AACA;AACA,OAAKC,oBAAL;AACA;AACA,EA1UO;AA2UR;AACAA,uBAAqB,gCAAU;AAC9B;AACA;AACA,MAAIC,OAAOpI,GAAGkG,EAAH,CAAM,KAAKhC,eAAL,GAAuB,CAA7B,EAAgC,KAAKD,OAAL,GAAe,EAA/C,CAAX;AACA;AACA,MAAIoE,WAASD,KAAKE,GAAL,CAAStI,GAAGkG,EAAH,CAAM,EAAN,EAAS,CAAT,CAAT,CAAb;AACA;AACA,MAAIqC,aAAavI,GAAGkG,EAAH,CAAM,KAAKhC,eAAL,GAAuB,CAA7B,EAAgC,CAAC,GAAD,GAAK,EAArC,CAAjB;AACA;AACA,MAAIsE,iBAAeD,WAAWD,GAAX,CAAetI,GAAGkG,EAAH,CAAM,CAAN,EAAQ,CAAR,CAAf,CAAnB;AACA;AACA,OAAKuC,iBAAL,GAAuB,KAAK7G,cAAL,GAAoB,EAA3C;AACA;AACA,MAAI8G,WAAW1I,GAAGkG,EAAH,CAAM,KAAKuC,iBAAL,GAAuB,CAAvB,GAAyB,KAAK9G,cAApC,EAAqD,CAAC,KAAKsC,OAAN,GAAgB,EAArE,CAAf;AACA;AACA,MAAI0E,eAAaD,SAASJ,GAAT,CAAatI,GAAGkG,EAAH,CAAM,CAAC,EAAP,EAAU,CAAV,CAAb,CAAjB;AACA;AACA,MAAI0C,WAAW5I,GAAGkG,EAAH,CAAM,CAAC,KAAKhC,eAAN,GAAwB,CAAxB,GAA0B,KAAG,CAAnC,EAAsC,MAAI,EAA1C,CAAf;;AAEA,MAAI2E,eAAaD,SAASN,GAAT,CAAatI,GAAGkG,EAAH,CAAM,CAAC,CAAP,EAAS,CAAC,CAAV,CAAb,CAAjB;AACA;AACA,OAAK4C,yBAAL,GAAiC,CAACV,IAAD,EAAOG,UAAP,EAAmBG,QAAnB,EAA6BE,QAA7B,CAAjC;AACA;AACA,OAAKhE,uBAAL,GAA+B,CAACyD,QAAD,EAAWG,cAAX,EAA2BG,YAA3B,EAAyCE,YAAzC,CAA/B;AACAtG,UAAQC,GAAR,CAAY,KAAKsG,yBAAjB;AACAvG,UAAQC,GAAR,CAAY,KAAKoC,uBAAjB;AACA,EAtWO;AAuWR;AACAsD,sBAAoB,+BAAU;AAC7B,MAAIa,SAAO,EAAX;AACA,MAAIC,UAAQ,GAAZ;AACA,MAAIC,UAAQ,EAAZ;AACA;AACA,MAAIb,OAAOpI,GAAGkG,EAAH,CAAM,KAAKlC,OAAL,GAAe+E,SAAO,CAAtB,GAAwBE,OAA9B,EAAuC,KAAKhF,OAAL,GAAe+E,UAAQ,CAAvB,GAAyB,EAAhE,CAAX;AACA;AACA,MAAIT,aAAavI,GAAGkG,EAAH,CAAM,CAAC,KAAKlC,OAAN,GAAgB+E,SAAO,CAAvB,GAAyBE,OAA/B,EAAwC,EAAxC,CAAjB;AACA;AACA,MAAIP,WAAW1I,GAAGkG,EAAH,CAAM,CAAC,KAAKlC,OAAN,GAAc,GAApB,EAA0B,CAAC,KAAKC,OAAN,GAAgB+E,UAAQ,CAAxB,GAA0BC,OAApD,CAAf;AACA;AACA,MAAIL,WAAW5I,GAAGkG,EAAH,CAAM,KAAKlC,OAAL,GAAe+E,SAAO,CAAtB,GAAwBE,OAA9B,EAAuC,EAAvC,CAAf;AACA;AACA,OAAKC,kBAAL,GAA0B,CAACd,IAAD,EAAOG,UAAP,EAAmBG,QAAnB,EAA6BE,QAA7B,CAA1B;AACArG,UAAQC,GAAR,CAAY,KAAK0G,kBAAjB;AACA,EAvXO;;AAyXR;AACAC,gBAAe,yBAAW;AACzB;AACA,OAAKzI,cAAL,GAAoB,EAApB;AACA;AACA,OAAK2B,OAAL,CAAauE,OAAb,CAAqB,UAASC,KAAT,EAAgB/B,KAAhB,EAAuB;AAC3C,QAAKsE,aAAL,CAAmBvC,KAAnB,EAA0B/B,KAA1B;AACA,GAFoB,CAEnBiC,IAFmB,CAEd,IAFc,CAArB;AAGA,EAjYO;AAkYR;AACAqC,gBAAe,uBAASzG,IAAT,EAAemC,KAAf,EAAsB;AACpC;AACAnC,OAAK,WAAL,IAAkBmC,KAAlB;AACA;AACA,MAAIuE,WAAW,KAAKC,sBAAL,CAA4BxE,KAA5B,CAAf;AACAnC,OAAK,UAAL,IAAiB0G,QAAjB;AACA;AACA1G,OAAK,gBAAL,IAAuB,KAAKuG,kBAAL,CAAwBG,QAAxB,CAAvB;AACA;AACA1G,OAAK,eAAL,IAAsB,KAAKiC,uBAAL,CAA6ByE,QAA7B,CAAtB;AACA;AACA1G,OAAK,iBAAL,IAAwB,KAAKmG,yBAAL,CAA+BO,QAA/B,CAAxB;AACA;AACA,MAAIxB,SAAS,KAAKD,cAAL,CAAoBjF,IAApB,CAAb;AACA;AACA;AACA;AACA,OAAKQ,IAAL,CAAU0B,QAAV,CAAmBgD,MAAnB;AACA,EArZO;AAsZR;AACA9C,sBAAoB,6BAASnC,GAAT,EAAa;AAChC,MAAI2G,YAAU,CAAd;AACA,OAAKlH,OAAL,CAAauE,OAAb,CAAqB,UAASC,KAAT,EAAgB/B,KAAhB,EAAuB;AAC3C,OAAG+B,MAAMjE,GAAN,IAAWA,GAAd,EAAkB;AACjB2G,gBAAUzE,KAAV;AACA;AACD,GAJD;AAKA,SAAOyE,SAAP;AACA,EA/ZO;AAgaR;AACAC,oBAAmB,2BAAS1E,KAAT,EAAgB;AAClC,MAAIuE,WAAW,KAAKC,sBAAL,CAA4BxE,KAA5B,CAAf;AACA,SAAO,KAAKoE,kBAAL,CAAwBG,QAAxB,CAAP;AACA,EApaO;AAqaR;AACAC,yBAAwB,gCAASxE,KAAT,EAAgB;AACvC,MAAIuE,WAAWvE,QAAQ,KAAKmD,eAA5B;AACA,MAAGoB,WAAW,CAAd,EAAiB;AAChBA,cAAWA,WAAW,CAAtB;AACA;AACD,SAAOA,QAAP;AACA,EA5aO;AA6aR;AACAlF,uBAAsB,gCAAW;AAChC;AACA,MAAIsF,MAAM,EAAV;AACA,MAAIlE,QAAQ,CAAC,MAAD,EAAS,MAAT,EAAiB,KAAjB,CAAZ;AACA,MAAIT,QAAQ,CAAZ;AACA;AACAS,QAAMqB,OAAN,CAAc,UAAS8C,EAAT,EAAa5C,GAAb,EAAkB;AAC/B;AACA,QAAI,IAAI6C,KAAK,CAAb,EAAgBA,MAAM,CAAtB,EAAyBA,IAAzB,EAA+B;AAC9B;AACA,SAAI,IAAIC,SAAS,CAAjB,EAAoBA,SAAS,CAA7B,EAAgCA,QAAhC,EAA0C;AACzCH,SAAIxG,IAAJ,CAAS;AACR,eAAS6B,KADD;AAER,aAAO4E,KAAK,GAAL,GAAWC,EAFV;AAGR,eAASD,EAHD;AAIR,gBAAUC;AAJF,MAAT;AAMA7E;AACA;AACD;AACD,GAdD;AAeA;AACA2E,MAAIrC,IAAJ,CAAS,YAAW;AACnB,UAAO,MAAMvD,KAAKgG,MAAL,EAAb;AACA,GAFD;AAGA;AACAJ,MAAIrC,IAAJ,CAAS,YAAW;AACnB,UAAO,MAAMvD,KAAKgG,MAAL,EAAb;AACA,GAFD;AAGA;AACA,OAAK3I,OAAL,GAAeuI,GAAf;AACA,EA7cO;AA8cR;AACAnG,iBAAe,0BAAU;AACxB;AACA;AACA,OAAKxB,YAAL;AACA,MAAIyC,OAAO,KAAKrD,OAAL,CAAa,KAAKY,YAAlB,CAAX;AACA,MAAIgI,WAAU,KAAK3G,IAAL,CAAU4G,cAAV,CAAyB,UAAzB,CAAd;AACA,MAAIC,aAAYF,SAASC,cAAT,CAAwB,YAAxB,CAAhB;AACA;AACA,MAAIE,YAAYD,WAAWD,cAAX,CAA0B,WAA1B,CAAhB;AACA,MAAIG,YAAWD,UAAUvF,YAAV,CAAuB,WAAvB,CAAf;AACAwF,YAAUC,MAAV,CAAiB5F,IAAjB;AACA;AACA,EA3dO;AA4dR;AACAgD,aAAY,sBAAW;AACtB;AACA;AACA;AACA,MAAIT,MAAMP,SAAS1C,KAAKgG,MAAL,KAAc,CAAvB,CAAV;AACA,MAAIjH,MAAM,KAAKP,OAAL,CAAayE,GAAb,EAAkBlE,GAA5B;AACA,OAAKd,YAAL;AACA,MAAIyC,OAAO,KAAKrD,OAAL,CAAa,KAAKY,YAAlB,CAAX;;AAEA;AACAsI,aAAW,YAAW;AACrB,QAAK9F,KAAL,CAAW1B,GAAX,EAAe2B,IAAf;AACA,GAFU,CAETwC,IAFS,CAEJ,IAFI,CAAX,EAEc,IAFd;AAGA,EA1eO;AA2eR;AACAxD,iBAAgB,0BAAW;AAC1B;AACA,MAAIZ,OAAO;AACVC,QAAK,KADK;AAEVC,aAAU,SAFA;AAGVC,WAAQ;AAHE,GAAX;AAKA,OAAKT,OAAL,CAAaY,IAAb,CAAkBN,IAAlB;AACA,OAAKyG,aAAL,CAAmBzG,IAAnB,EAAyB,KAAKN,OAAL,CAAagD,MAAb,GAAsB,CAA/C;AACA;AACA,MAAG,KAAKhD,OAAL,CAAagD,MAAb,IAAsB,CAAzB,EAA6B;AAC5B,QAAK/D,UAAL,CAAgB+I,OAAhB,GAA0B,KAA1B;AACA;AACD,EAzfO;AA0fR;AACA7G,eAAa,wBAAU;AACtB,MAAIsG,WAAU,KAAK3G,IAAL,CAAU4G,cAAV,CAAyB,UAAzB,CAAd;AACA,MAAIC,aAAYF,SAASC,cAAT,CAAwB,YAAxB,CAAhB;AACA,MAAIO,cAAaR,SAASC,cAAT,CAAwB,aAAxB,CAAjB;AACA,MAAIQ,UAAUD,YAAY5F,YAAZ,CAAyB,SAAzB,CAAd;AACA;AACA,MAAI8F,WAAUR,WAAWD,cAAX,CAA0B,UAA1B,CAAd;AACA;AACA,MAAIU,OAAOD,SAAS9F,YAAT,CAAsB,MAAtB,CAAX;AACA,MAAI/B,OAAO;AACVC,QAAK,KADK;AAEVC,aAAU,SAFA;AAGVC,WAAQ;AAHE,GAAX;AAKA2H,OAAKC,YAAL,CAAkB/H,IAAlB;AACA;AACA,MAAIsH,YAAYD,WAAWD,cAAX,CAA0B,WAA1B,CAAhB;AACA,MAAIY,QAAOV,UAAUvF,YAAV,CAAuB,WAAvB,CAAX;;AAEA;AACA,MAAIkG,gBAAeZ,WAAWD,cAAX,CAA0B,eAA1B,CAAnB;AACA,MAAIG,YAAYU,cAAclG,YAAd,CAA2B,WAA3B,CAAhB;;AAEA;AACAiG,QAAMT,SAAN,GAAgBA,SAAhB;AACA;AACA;AACAS,QAAMhF,IAAN,GAAW,IAAX;;AAEAuE,YAAUS,KAAV,GAAgBA,KAAhB;AACA;AACA;AACAT,YAAUvE,IAAV,GAAe,IAAf;;AAEA;AACAuE,YAAUW,OAAV,GAAkBN,OAAlB;AACAI,QAAME,OAAN,GAAcN,OAAd;;AAGA,OAAKpG,oBAAL;;AAEA,MAAIc,YAAY,EAAhB;AACA,MAAIC,SAAS,EAAb;AACA,OAAI,IAAIC,IAAI,CAAZ,EAAeA,IAAIF,SAAnB,EAA8B,EAAEE,CAAhC,EAAmC;AAClC,OAAIC,MAAM,KAAKlE,OAAL,CAAaiE,CAAb,CAAV;AACAD,UAAOjC,IAAP,CAAYmC,GAAZ;AACA,QAAKtD,YAAL;AACA;AACDoI,YAAUY,gBAAV,CAA2B5F,MAA3B;AACA3C,UAAQC,GAAR,CAAYoI,aAAZ;AACA,EA7iBO;AA8iBR;AACAvG,oBAAkB,6BAAU;AAC3B,MAAIY,YAAY,EAAhB;AACA,MAAIC,SAAS,EAAb;AACA,OAAI,IAAIC,IAAI,CAAZ,EAAeA,IAAIF,SAAnB,EAA8B,EAAEE,CAAhC,EAAmC;AAClC,OAAIC,MAAM,KAAKlE,OAAL,CAAaiE,CAAb,CAAV;AACAD,UAAOjC,IAAP,CAAYmC,GAAZ;AACA,QAAKtD,YAAL;AACA;AACD,OAAI,IAAIqD,MAAI,CAAZ,EAAeA,MAAID,OAAOG,MAA1B,EAAkC,EAAEF,GAApC,EAAuC;AACtC,OAAIZ,OAAOW,OAAOC,GAAP,CAAX;AACA;AACA;AACA;AACA;AACA;AACD;AA9jBO,CAAT","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["/**\r\n * 桌面总控制\r\n */\r\nconst Player = require('Player');\r\ncc.Class({\r\n\textends: cc.Component,\r\n\r\n\tproperties: {\r\n\t\t//麻将实体引用\r\n\t\tmajiangPrefab: {\r\n\t\t\tdefault: null,\r\n\t\t\ttype: cc.Prefab\r\n\t\t},\r\n\t\t//玩家引用\r\n\t\tplayerPrefab: {\r\n\t\t\tdefault: null,\r\n\t\t\ttype: cc.Prefab\r\n\t\t},\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tplayerEntities:{\r\n\t\t\tdefault:[], \r\n\t\t\ttype:Player\r\n\t\t},\r\n\t\t//打出去多少张\r\n\t\ttakeoutIndex: 0,\r\n\t\t//打出去缩放比例\r\n\t\ttakeoutScale: 1,\r\n\t\t//初始化缩放比例\r\n\t\tinitScale: 1.25,\r\n\t\t//单个麻将宽度\r\n\t\tmajiangWidth: 58,\r\n\t\t//单个麻将高度\r\n\t\tmajiangHeight: 84,\r\n\t\t//麻将间隙，适用于所有横的排列\r\n\t\tmajiangJianxi: 4,\r\n\t\t//打出去牌的Y坐标\r\n\t\tbasicTakeoutY: 0,\r\n\t\t//测试专用，108张牌的原始值\r\n\t\tnumbers: [],\r\n\t\t//准备按钮\r\n\t\tbtnReady: cc.Button,\r\n\t\t//摸牌按钮\r\n\t\tbtnGetOne: cc.Button,\r\n\t\t//加入一个新玩家\r\n\t\tbtnJoinOne: cc.Button,\r\n\t\t//新开始\r\n\t\tbtnNewReady: cc.Button,\r\n\t\t//对子组数量\r\n\t\tduiziCount: 0,\r\n\t\t//一组对子的宽度\r\n\t\tduiziWidth: 0,\r\n\t\t//对子缩放比例\r\n\t\tduiziScale: 1,\r\n\t\t//对面麻将\r\n\t\tduimianMjScale: 1,\r\n\t\t//对面麻将宽度\r\n\t\tduimianMjWidth: 36,\r\n\t\t//是否只能选择一张\r\n\t\tisSingle: true,\r\n\t\t//麻将索引\r\n\t\tmajiangIndex: 0,\r\n\t\t//新摸的一颗(测试无误后，可以删除)\r\n\t\tcurrentMajiang: null,\r\n\t\t//是否新摸一张牌\r\n\t\thasNewMajiang:false,\r\n\t\t//手头牌列表\r\n\t\tshouliList: [],\r\n\t\t//对子列表\r\n\t\tduiziList: [],\r\n\t\t//暗杠列表\r\n\t\tangangList: [],\r\n\t\t//明杠列表\r\n\t\tminggangList: [],\r\n\t\t//玩家列表,4条数据\r\n\t\tplayers: [],\r\n\t\tplayerEntities:null,\r\n\t\t//用户id\r\n\t\tuserId: 0,\r\n\t\t//我在桌子上的位置\r\n\t\tmyPositionIndex: 0\r\n\t},\r\n\r\n\t// LIFE-CYCLE CALLBACKS:\r\n\r\n\tonLoad() {\r\n\t\tconsole.log(\"开始游戏，创建对象池\");\r\n\t\t//console.log(this.node)\r\n\t\t//初始化各种默认数字\r\n\t\tthis.initDefaultNumber();\r\n\t\t//模拟从服务器获得自己的id,所以我自己是南方\r\n\t\tthis.userId = 10002;\r\n\t\t//初始化加载自己的头像\r\n\t\tlet user = {\r\n\t\t\tuid: 10001,\r\n\t\t\tnickname: \"特工10001\",\r\n\t\t\tavatar: \"http://file5.cjblog.org/upload/b27695e79fd8908de0b18507f89d5b7c.jpg?x-oss-process=style/w60h60\"\r\n\t\t};\r\n\t\tlet user2 = {\r\n\t\t\tuid: 10002,\r\n\t\t\tnickname: \"特工10002\",\r\n\t\t\tavatar: \"http://file5.cjblog.org/upload/b27695e79fd8908de0b18507f89d5b7c.jpg?x-oss-process=style/w60h60\"\r\n\t\t};\r\n\t\tlet user3 = {\r\n\t\t\tuid: 10003,\r\n\t\t\tnickname: \"特工10003\",\r\n\t\t\tavatar: \"http://file5.cjblog.org/upload/b27695e79fd8908de0b18507f89d5b7c.jpg?x-oss-process=style/w60h60\"\r\n\t\t};\r\n\t\tthis.players.push(user);\r\n\t\tthis.players.push(user2);\r\n\t\tthis.players.push(user3);\r\n\t\tconsole.log(this.players);\r\n\t\t//识别方位，初始化方位图\r\n\t\tthis.initUserPosition();\r\n\t\t//加入所有人\r\n\t\t//this.joinAllPeople();\r\n\t\t\r\n\t\t//准备按钮绑定事件\r\n\t\tthis.btnReady.node.on('click', this.beginEvent, this);\r\n\t\t//测试摸牌按钮\r\n\t\tthis.btnGetOne.node.on('click', this.testBeginMopai, this);\r\n\t\tthis.btnJoinOne.node.on('click', this.testJoinPeople, this);\r\n\t\t//新开始\r\n\t\tthis.btnNewReady.node.on('click',this.testNewBegin,this);\r\n\t},\r\n\r\n\tstart() {\r\n\r\n\t},\r\n\r\n\tupdate(dt) {\r\n\t\t//console.log(\"更新画布\",dt)\r\n\t},\r\n\t//初始化各种默认数字\r\n\tinitDefaultNumber:function(){\r\n\t\tlet width = Math.floor(this.node.width);\r\n\t\tlet height = Math.floor(this.node.height);\r\n\t\t//右下角位置点\r\n\t\tthis.originX = -width / 2;\r\n\t\tthis.originY = -height / 2;\r\n\t\tthis.basicTakeoutY = this.originY + this.majiangHeight * this.initScale + 40;\r\n\t\tconsole.log(width, height);\r\n\t\t//麻将总长=（麻将宽度-间隙）*13\r\n\t\tthis.majiangAllWidth = (this.majiangWidth * this.initScale - this.majiangJianxi) * 13;\r\n\t\t//计算一组对子(杠)的宽度，三张牌放底下，缩放80%\r\n\t\tthis.duiziWidth = (this.majiangWidth - this.majiangJianxi) * 3 * this.duiziScale;\r\n\t},\r\n\t//点击准备按钮，socket连接服务器，等待发牌指令\r\n\tbeginEvent: function() {\r\n\t\tconsole.log(\"我已经准备好了\");\r\n\t\t//告诉服务器自己的准备状态，服务器判断是否满足4人，如果满足，即可开始\r\n\t\t//洗牌\r\n\t\tthis.testGetRandomNumbers();\r\n\t\t//初始化自己拍\r\n\t\tthis.initAllMajiang();\r\n\t\t//初始化下家的牌\r\n\t\tthis.initDownStairsMjs();\r\n\t},\r\n\tmopai: function(uid,mjzz) {\r\n\t\tconsole.log(\"用户：\",uid,\"摸牌\",mjzz);\r\n\t\t//某个用户得到一张牌,如果是别人，是没有点数的，只有一个空对象，所以区分是自己还是别人\t\r\n\t\tif(uid == this.userId){\r\n\t\t\tlet mj = this.spawnNewMj(mjzz);\r\n\t\t\tthis.hasNewMajiang=true;\r\n\t\t\tthis.currentMajiang = mj.getComponent('MajiangEntity');\r\n\t\t\t\r\n\t\t\t//let aw = this.getAW();\r\n\t\t\t//设置固定位置，index是变化的\r\n\t\t\t//设置为自己的新牌位置\r\n\t\t\tmj.setPosition(this.playerNewMjPositionList[0]);\r\n\t\t\tthis.node.addChild(mj);\r\n\t\t}else{\r\n\t\t\t//座位index\r\n\t\t\tlet index = this.getPlayerIndexByUid(uid);\r\n\t\t\t//得到新牌坐标\r\n\t\t\tlet pos = this.playerNewMjPositionList[index];\r\n\t\t\t\r\n\t\t}\r\n\t},\r\n\r\n\tinitAllMajiang: function() {\r\n\t\tlet initCount = 13;\r\n\t\tlet nubArr = [];\r\n\t\tfor(let i = 0; i < initCount; ++i) {\r\n\t\t\tlet ent = this.numbers[i];\r\n\t\t\tnubArr.push(ent);\r\n\t\t\tthis.majiangIndex++;\r\n\t\t}\r\n\t\tconsole.log(nubArr)\r\n\t\tfor(let i = 0; i < nubArr.length; ++i) {\r\n\t\t\tlet mjzz = nubArr[i];\r\n\t\t\t//生成一个新麻将\r\n\t\t\tlet mj = this.spawnNewMj(mjzz);\r\n\t\t\t//添加到节点上\r\n\t\t\tthis.node.addChild(mj);\r\n\t\t}\r\n\t\t//把默认是乱的顺序，排列整齐,可以加一个特效\r\n\t\t//1.盖牌特效\r\n\t\t//2.整理顺序\r\n\t\tthis.updateShoulipai();\r\n\t\t//3.翻牌特效\r\n\t},\r\n\t//生成麻将对象\r\n\tspawnNewMj: function(mjzz) {\r\n\t\tconsole.log(\"创建麻将：\", mjzz.huase, mjzz.number)\r\n\t\tvar mj = cc.instantiate(this.majiangPrefab);\r\n\t\tvar config = mj.getComponent('MajiangEntity');\r\n\t\tconfig.game = this;\r\n\t\tconfig.huase = mjzz.huase;\r\n\t\tconfig.number = mjzz.number;\r\n\t\tconfig.index = mjzz.index;\r\n\t\tmj.setScale(this.initScale);\r\n\t\t//把所有牌放入手头牌列表，即使是新牌，也算是自己的\r\n\t\tthis.shouliList.push(config);\r\n\t\treturn mj;\r\n\t},\r\n\t//初始化其他玩家的牌，并不需要具体点数\r\n\tspawnNewOtherMj:function(pos){\r\n\t\t//区分是上家、下家还是对家\r\n\t},\r\n\t//获取每个麻将位置\r\n\tgetNewMjPosition: function(index, isNewOne, start) {\r\n\t\t//获取新麻将的位置\r\n\t\tvar randX = start - this.majiangAllWidth / 2 + (index) * (this.majiangWidth * this.initScale - this.majiangJianxi);\r\n\t\tvar randY = this.originY + 70; //-this.node./2;\r\n\t\t//console.log(\"位置1：\", index, randX, randY);\r\n\t\tif(isNewOne) {\r\n\t\t\trandX = randX + 20;\r\n\t\t\tconsole.log(\"新牌位置：\", index, randX, randY);\r\n\t\t}\r\n\t\treturn cc.v2(randX, randY);\r\n\t},\r\n\tgetTakeOutPosition: function(node) {\r\n\t\t//console.log(node)\r\n\t\t//手里牌对象池移除\r\n\t\t//this.majiangPool.put(node);\r\n\t\t//放入打出去的对象池\r\n\t\t//this.majiangOutPool.put(node);\r\n\t\t//this.node.addChild(node);\r\n\t\t//let mjSize = this.majiangPool.size();\r\n\t\t//console.log(\"剩余张数\",mjSize);\r\n\t\tlet scaleWidth = (this.majiangWidth - this.majiangJianxi) * this.takeoutScale;\r\n\t\tlet outNumb = 10;\r\n\t\t//获取打出去的位置\r\n\t\tlet outLevel = parseInt(this.takeoutIndex / outNumb);\r\n\t\t//scaleWidth*10/2+\r\n\t\t//let mjX=this.originX+300+(scaleWidth*(this.takeoutIndex-outLevel*outNumb));\r\n\t\tlet mjX = -outNumb * scaleWidth / 2 + (scaleWidth * (this.takeoutIndex - outLevel * outNumb));\r\n\r\n\t\tlet mjY = this.basicTakeoutY + outLevel * (this.majiangHeight * this.takeoutScale);\r\n\t\tthis.takeoutIndex++;\r\n\t\tconsole.log(\"垃圾桶位置：\", outLevel, mjX, mjY);\r\n\t\t//调用重新排序\r\n\t\treturn cc.v2(mjX, mjY);\r\n\t},\r\n\t//移除手里牌\r\n\tremoveShoulipai:function(ent){\r\n\t\tlet shouli=[];\r\n\t\tthis.shouliList.forEach(function(value, ind) {\r\n\t\t\tif(value.index != ent.index){\r\n\t\t\t\tshouli.push(value);\r\n\t\t\t}\r\n\t\t}.bind(this));\r\n\t\tthis.shouliList=shouli;\r\n\t\tthis.updateShoulipai(true)\r\n\t},\r\n\t//更新手里牌\r\n\tupdateShoulipai: function(getOther) {\r\n\t\t//更新手里牌http://www.w3school.com.cn/jsref/jsref_splice.asp\r\n\t\tlet newList = [];\r\n\t\t//计算可操作牌的起点位置\r\n\t\tlet aw = this.getAW();\r\n\t\tlet index = 0;\r\n\t\t//新摸的牌已经放到最后一张，所以需要重新排序\r\n\t\tthis.shouliList.sort(function(a, b) {\r\n\t\t\treturn a.index - b.index;\r\n\t\t});\r\n\t\t//循环设置新坐标\r\n\t\tthis.shouliList.forEach(function(value, ind) {\r\n\t\t\tvalue.node.setPosition(this.getNewMjPosition(ind, false, aw));\r\n\t\t}.bind(this));\r\n\t\t//重新排序后，表示没有新牌进入\r\n        this.hasNewMajiang=false;\r\n        if(getOther){\r\n        \t//@todo 测试再摸一张\r\n        \tthis.testGetOne();\r\n        }\r\n\t},\r\n\t//获取麻将排列起点位置\r\n\tgetAW: function() {\r\n\t\tlet duigangWidth = this.duiziWidth;\r\n\t\tlet aw = (this.duiziList.length + this.angangList.length + this.minggangList.length) * (duigangWidth + 10) + 50;\r\n\t\treturn aw;\r\n\t},\r\n\t//当选中一个小主之后，让其他小主坐冷板凳\r\n\tunSelectOthers: function(ent) {\r\n\t\t//定缺，平时选择一张\r\n\t\tif(this.isSingle) {\r\n\t\t\tthis.shouliList.forEach(function(value, ind) {\r\n\t\t\t\tif(value.index != ent.index && value.isSelected) {\r\n\t\t\t\t\tvalue.unSelect();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\t//生成玩家对象\r\n\tspawnNewPlayer: function(player) {\r\n\t\tconsole.log(\"创建玩家：\", player.uid, player.nickname, player.avatar)\r\n\t\tvar playerEntity = cc.instantiate(this.playerPrefab);\r\n\t\tvar config = playerEntity.getComponent('Player');\r\n\t\tconfig.game = this;\r\n\t\tconfig.userinfo=player;\r\n\t\t//玩家实体数组，方便以后调用,摸牌，出牌，都由实体对象调用\r\n\t\tthis.playerEntities[player.uid]=config;\r\n\t\treturn playerEntity;\r\n\t},\r\n\t//其他玩家出牌，分别记录他们的出牌位置\r\n\tsetOtherTakeOutPosition: function() {\r\n\r\n\t},\r\n\t//计算用户的属性，包含：头像坐标，新牌，定位牌\r\n\tinitUserPosition: function() {\r\n\t\t//拿到自己的index\r\n\t\tthis.players.forEach(function(value, index) {\r\n\t\t\tif(value.uid == this.userId) {\r\n\t\t\t\tthis.myPositionIndex = index;\r\n\t\t\t}\r\n\t\t}.bind(this));\r\n\t\t//初始化所有头像位置\r\n\t\tthis.initAvatarPositions();\r\n\t\t//初始化其他玩家手里牌固定位置\r\n\t\tthis.initFixedMjPositions();\r\n\t\t//@todo 更新方位图(中间的东南西北图片)\r\n\t},\r\n\t//初始化每一位玩家不动的位置\r\n\tinitFixedMjPositions:function(){\r\n\t\t//自己牌的总宽度/2\r\n\t\t//计算出东南西北的坐标\r\n\t\tlet mine = cc.v2(this.majiangAllWidth / 2, this.originY + 70);\r\n\t\t//新牌位置，向右增加10像素\r\n\t\tlet mine_new=mine.add(cc.v2(10,0));\r\n\t\t//楼下,侧面每一张牌相距20，*6张牌+全侧面一张，从下往上算\r\n\t\tlet downstairs = cc.v2(this.majiangAllWidth / 2, -120+64);\r\n\t\t//楼下新牌，比固定增加5像素\r\n\t\tlet downstairs_new=downstairs.add(cc.v2(5,5));\r\n\t\t//对面麻将总宽度\r\n\t\tthis.duimianMjAllWidth=this.duimianMjWidth*13;\r\n\t\t//对面麻将初始位置，从左往右算\r\n\t\tlet opposite = cc.v2(this.duimianMjAllWidth/2*this.duimianMjScale , -this.originY - 64);\r\n\t\t//对面新牌位置，向左移动5像素\t\t\r\n\t\tlet opposite_new=opposite.add(cc.v2(-10,0));\r\n\t\t//楼上，从上往下算\r\n\t\tlet upstairs = cc.v2(-this.majiangAllWidth / 2+10*6, 120+64);\r\n\t\t\r\n\t\tlet upstairs_new=upstairs.add(cc.v2(-5,-5));\r\n\t\t//初始每人第一张牌的位置\r\n\t\tthis.playerFixedMjPositionList = [mine, downstairs, opposite, upstairs];\r\n\t\t//初始化每人新牌的位置\n\t\tthis.playerNewMjPositionList = [mine_new, downstairs_new, opposite_new, upstairs_new];\r\n\t\tconsole.log(this.playerFixedMjPositionList);\r\n\t\tconsole.log(this.playerNewMjPositionList);\r\n\t},\r\n\t//头像位置\r\n\tinitAvatarPositions:function(){\r\n\t\tlet aWidth=86;\r\n\t\tlet aHeight=126;\r\n\t\tlet padding=20;\r\n\t\t//计算出东南西北的坐标\r\n\t\tlet mine = cc.v2(this.originX + aWidth/2+padding, this.originY + aHeight/2+60);\r\n\t\t//楼下\r\n\t\tlet downstairs = cc.v2(-this.originX - aWidth/2-padding, 80);\r\n\t\t//对面\r\n\t\tlet opposite = cc.v2(-this.originX-280 , -this.originY - aHeight/2-padding);\r\n\t\t//楼上\r\n\t\tlet upstairs = cc.v2(this.originX + aWidth/2+padding, 80);\r\n\t\t//初始头像位置\r\n\t\tthis.avatarPositionList = [mine, downstairs, opposite, upstairs];\r\n\t\tconsole.log(this.avatarPositionList);\r\n\t},\r\n\t\r\n\t//第一次加入所有人\r\n\tjoinAllPeople: function() {\r\n\t\t//初始化玩家对象实体数据\r\n\t\tthis.playerEntities={};\r\n\t\t//批量加入，此数组至少存在一条数据，就是自己\r\n\t\tthis.players.forEach(function(value, index) {\r\n\t\t\tthis.joinNewPeople(value, index);\r\n\t\t}.bind(this));\r\n\t},\r\n\t//有人员加入\r\n\tjoinNewPeople: function(user, index) {\r\n\t\t//加入顺序\r\n\t\tuser[\"joinIndex\"]=index;\r\n\t\t//相对位置索引，从我算起\r\n\t\tlet posIndex = this.getPlayerPositionIndex(index);\r\n\t\tuser[\"posIndex\"]=posIndex;\r\n\t\t//头像位置\r\n\t\tuser[\"avatarPosition\"]=this.avatarPositionList[posIndex];\r\n\t\t//新麻将位置\r\n\t\tuser[\"newMjPosition\"]=this.playerNewMjPositionList[posIndex];\r\n\t\t//固定位置麻将\r\n\t\tuser[\"fixedMjPosition\"]=this.playerFixedMjPositionList[posIndex];\r\n\t\t//创建玩家对象\r\n\t\tlet player = this.spawnNewPlayer(user);\r\n\t\t//设置坐标\r\n\t\t//player.setPosition(this.getPlayerPosition(index));\r\n\t\t//加入到画布\r\n\t\tthis.node.addChild(player);\r\n\t},\r\n\t//根据用户id，获得座位index\r\n\tgetPlayerIndexByUid:function(uid){\r\n\t\tlet userIndex=0;\r\n\t\tthis.players.forEach(function(value, index) {\r\n\t\t\tif(value.uid==uid){\r\n\t\t\t\tuserIndex=index;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn userIndex;\r\n\t},\r\n\t//根据索引index获取玩家坐标\r\n\tgetPlayerPosition: function(index) {\r\n\t\tlet posIndex = this.getPlayerPositionIndex(index);\r\n\t\treturn this.avatarPositionList[posIndex]\r\n\t},\r\n\t//获取玩家位置，index为玩家列表索引\r\n\tgetPlayerPositionIndex: function(index) {\r\n\t\tlet posIndex = index - this.myPositionIndex;\r\n\t\tif(posIndex < 0) {\r\n\t\t\tposIndex = posIndex + 4;\r\n\t\t}\r\n\t\treturn posIndex;\r\n\t},\r\n\t//本地测试专用，生成108张新牌序列，理论上是在服务器生成，下发13张到本地\r\n\ttestGetRandomNumbers: function() {\r\n\t\t//产生1-9数字 numbers  ,每个花色36个数字\r\n\t\tvar arr = [];\r\n\t\tvar huase = [\"tiao\", \"tong\", \"wan\"];\r\n\t\tvar index = 0;\r\n\t\t//遍历花色\r\n\t\thuase.forEach(function(se, ind) {\r\n\t\t\t//遍历1-9数字\r\n\t\t\tfor(let ds = 1; ds <= 9; ds++) {\r\n\t\t\t\t//每种产生4张\r\n\t\t\t\tfor(let amount = 0; amount < 4; amount++) {\r\n\t\t\t\t\tarr.push({\r\n\t\t\t\t\t\t\"index\": index,\r\n\t\t\t\t\t\t\"key\": se + \"_\" + ds,\r\n\t\t\t\t\t\t\"huase\": se,\r\n\t\t\t\t\t\t\"number\": ds\r\n\t\t\t\t\t});\r\n\t\t\t\t\tindex++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t//第一次打乱\r\n\t\tarr.sort(function() {\r\n\t\t\treturn 0.5 - Math.random()\r\n\t\t});\r\n\t\t//第二次打乱\r\n\t\tarr.sort(function() {\r\n\t\t\treturn 0.5 - Math.random()\r\n\t\t});\r\n\t\t//console.log(arr);\r\n\t\tthis.numbers = arr;\r\n\t},\r\n\t//测试自己摸牌一次\r\n\ttestBeginMopai:function(){\r\n\t\t//点击启动开始摸牌,获取东的uid和获取一张牌\r\n\t\t//let uid = this.players[0].uid;\r\n\t\tthis.majiangIndex++;\r\n\t\tlet mjzz = this.numbers[this.majiangIndex];\r\n\t\tlet LeadSeat= this.node.getChildByName(\"LeadSeat\");\r\n\t\tlet ShowMjNode =LeadSeat.getChildByName(\"ShowMjNode\");\r\n\t\t//新牌区域\r\n\t\tlet NewMjNode = ShowMjNode.getChildByName(\"NewMjNode\");\r\n\t\tlet CurrentMj= NewMjNode.getComponent(\"CurrentMj\");\r\n\t\tCurrentMj.getOne(mjzz);\r\n\t\t//this.btnGetOne.enabled = false;\r\n\t},\r\n\t//测试定时摸牌，需要改成轮流摸牌\r\n\ttestGetOne: function() {\r\n\t\t//摸一张，放到最右手边，理论上从服务器获得一个号码，测试从本地获取\r\n\t\t//随机uid摸牌，用来对接服务器发来的信号，只能是暗杠，才能连续摸两张，\r\n\t\t//生成0-3的数字\r\n\t\tlet ind = parseInt(Math.random()*4);\r\n\t\tlet uid = this.players[ind].uid;\r\n\t\tthis.majiangIndex++;\r\n\t\tlet mjzz = this.numbers[this.majiangIndex];\r\n\t\t\r\n\t\t//测试专用，3秒自动摸牌\r\n\t\tsetTimeout(function() {\r\n\t\t\tthis.mopai(uid,mjzz);\r\n\t\t}.bind(this), 3000)\r\n\t},\r\n\t//测试加入新用户\r\n\ttestJoinPeople: function() {\r\n\t\t//从服务器得到一个用户，包含{id,nickname,avatar}\r\n\t\tlet user = {\r\n\t\t\tuid: 10004,\r\n\t\t\tnickname: \"张三10004\",\r\n\t\t\tavatar: \"http://file5.cjblog.org/upload/b27695e79fd8908de0b18507f89d5b7c.jpg?x-oss-process=style/w60h60\"\r\n\t\t};\r\n\t\tthis.players.push(user);\r\n\t\tthis.joinNewPeople(user, this.players.length - 1);\r\n\t\t//最多存放4个人\r\n\t\tif(this.players.length ==4 ) {\r\n\t\t\tthis.btnJoinOne.enabled = false;\r\n\t\t}\r\n\t},\r\n\t//新测试\r\n\ttestNewBegin:function(){\r\n\t\tlet LeadSeat= this.node.getChildByName(\"LeadSeat\");\r\n\t\tlet ShowMjNode =LeadSeat.getChildByName(\"ShowMjNode\");\r\n\t\tlet DustbinNode =LeadSeat.getChildByName(\"DustbinNode\");\r\n\t\tlet Dustbin = DustbinNode.getComponent(\"Dustbin\") ;\r\n\t\t//信息卡区域\n\t\tlet CardNode =ShowMjNode.getChildByName(\"CardNode\");\r\n\t\t//初始化头像\r\n\t\tlet card = CardNode.getComponent(\"Card\") ;\r\n\t\tlet user = {\r\n\t\t\tuid: 10008,\r\n\t\t\tnickname: \"张三10008\",\r\n\t\t\tavatar: \"http://file5.cjblog.org/upload/b27695e79fd8908de0b18507f89d5b7c.jpg?x-oss-process=style/w60h60\"\r\n\t\t};\r\n\t\tcard.initCardInfo(user);\r\n\t\t//新牌区域\r\n\t\tlet NewMjNode = ShowMjNode.getChildByName(\"NewMjNode\");\r\n\t\tlet NewMj= NewMjNode.getComponent(\"CurrentMj\");\n\t\t\r\n\t\t//手里牌区域\r\n\t\tlet CurrentMjNode =ShowMjNode.getChildByName(\"CurrentMjNode\");\r\n\t\tlet CurrentMj = CurrentMjNode.getComponent(\"CurrentMj\");\r\n\t\t\r\n\t\t//绑定新牌区域和手里牌区域的相互引用\r\n\t\tNewMj.CurrentMj=CurrentMj;\r\n\t\t//NewMj.shouliList=this.shouliList;\r\n\t\t//NewMj.hasNewMajiang=this.hasNewMajiang;\r\n\t\tNewMj.game=this;\r\n\t\t\r\n\t\tCurrentMj.NewMj=NewMj;\r\n\t\t//CurrentMj.shouliList=this.shouliList;\r\n\t\t//CurrentMj.hasNewMajiang=this.hasNewMajiang;\r\n\t\tCurrentMj.game=this;\r\n\t\t\r\n\t\t//绑定垃圾桶绑定\r\n\t\tCurrentMj.dustbin=Dustbin;\r\n\t\tNewMj.dustbin=Dustbin;\r\n\t\t\r\n\t\t\r\n\t\tthis.testGetRandomNumbers();\r\n\t\t\r\n\t\tlet initCount = 13;\r\n\t\tlet nubArr = [];\r\n\t\tfor(let i = 0; i < initCount; ++i) {\r\n\t\t\tlet ent = this.numbers[i];\r\n\t\t\tnubArr.push(ent);\r\n\t\t\tthis.majiangIndex++;\r\n\t\t}\r\n\t\tCurrentMj.initAllCurrentMj(nubArr);\r\n\t\tconsole.log(CurrentMjNode)\r\n\t},\r\n\t//测试初始化下家手里牌\r\n\tinitDownStairsMjs:function(){\r\n\t\tlet initCount = 13;\r\n\t\tlet nubArr = [];\r\n\t\tfor(let i = 0; i < initCount; ++i) {\r\n\t\t\tlet ent = this.numbers[i];\r\n\t\t\tnubArr.push(ent);\r\n\t\t\tthis.majiangIndex++;\r\n\t\t}\r\n\t\tfor(let i = 0; i < nubArr.length; ++i) {\r\n\t\t\tlet mjzz = nubArr[i];\r\n\t\t\t//生成一个新麻将\r\n\t\t\t//let mj = this.spawnNewMj(mjzz);\r\n\t\t\t//添加到节点上\r\n\t\t\t//this.node.addChild(mj);\r\n\t\t}\r\n\t}\r\n});"]}