{"version":3,"sources":["CurrentMj.js"],"names":["cc","Class","extends","Component","properties","MjSprite","default","type","Prefab","outPrefab","majiangWidth","majiangHeight","majiangJianxi","initScale","realMjWidth","onLoad","start","initAllCurrentMj","mjs","width","node","aLength","length","fixedPosition","getFixedPosition","forEach","value","index","majiang","spawnNewMj","pos","sub","v2","setPosition","addChild","bind","scheduleUpdate","scheduleOnce","updateSort","getOne","mjzz","console","log","game","hasNewMajiang","CurrentMj","isNewOne","huase","number","mj","instantiate","config","getComponent","setScale","shouliList","push","spawnNewOutMj","unSelectOthers","ent","isSelected","unSelect","newList","sort","a","b","newNode","newPos","parentNode","parent","removeFromList","destroy","takeOut","posX","x","outMj","dustbin","moveMjFromNew"],"mappings":";;;;;;AAAA;;;AAGAA,GAAGC,KAAH,CAAS;AACLC,UAASF,GAAGG,SADP;;AAGLC,aAAY;AACX;AACHC,YAAU;AACTC,YAAS,IADA;AAETC,SAAMP,GAAGQ;AAFA,GAFI;AAMb;AACDC,aAAU;AACTH,YAAQ,IADC;AAETC,SAAKP,GAAGQ;AAFC,GAPI;AAWd;AACAE,gBAAc,EAZA;AAad;AACAC,iBAAe,EAdD;AAed;AACAC,iBAAe,CAhBD;AAiBd;AACA;AACA;AACAC,aAAW,IApBG;AAqBd;AACA;AACAC,eAAY;;AAvBE,EAHP;;AA8BL;;AAEAC,OAhCK,oBAgCK;AACT;AACA,OAAKD,WAAL,GAAiB,CAAC,KAAKJ,YAAL,GAAkB,KAAKE,aAAxB,IAAuC,KAAKC,SAA7D;AACA,EAnCI;AAqCLG,MArCK,mBAqCI,CAER,CAvCI;;AAwCL;AACAC,mBAAiB,0BAASC,GAAT,EAAa;AAC7B,MAAIC,QAAM,KAAKC,IAAL,CAAUD,KAApB;AACA,MAAIE,UAAQH,IAAII,MAAJ,GAAW,CAAvB;AACA;AACA,MAAIC,gBAAc,KAAKC,gBAAL,EAAlB;AACA;AACAN,MAAIO,OAAJ,CAAY,UAASC,KAAT,EAAeC,KAAf,EAAqB;AAChC,OAAIC,UAAU,KAAKC,UAAL,CAAgBH,KAAhB,EAAsB,KAAtB,CAAd;AACA;AACA,OAAII,MAAIP,cAAcQ,GAAd,CAAkB/B,GAAGgC,EAAH,CAAM,CAACX,UAAQM,KAAT,IAAgB,KAAKb,WAA3B,EAAuC,CAAvC,CAAlB,CAAR;AACA;AACAc,WAAQK,WAAR,CAAoBH,GAApB;AACA,QAAKV,IAAL,CAAUc,QAAV,CAAmBN,OAAnB;AACA,GAPW,CAOVO,IAPU,CAOL,IAPK,CAAZ;AAQA;AACA;AACA,OAAKC,cAAL;AACA,EA1DI;AA2DLA,iBAAe,0BAAU;AACxB,OAAKC,YAAL,CAAkB,YAAW;AAC3B,QAAKC,UAAL;AACH,GAFC,EAEC,GAFD;AAGA,EA/DI;AAgERC,SAAO,gBAASC,IAAT,EAAc;AACpBC,UAAQC,GAAR,CAAY,MAAZ;AACA,OAAKC,IAAL,CAAUC,aAAV,GAAwB,IAAxB;AACA,MAAIhB,UAAU,KAAKC,UAAL,CAAgBW,IAAhB,EAAqB,IAArB,CAAd;AACA,OAAKpB,IAAL,CAAUc,QAAV,CAAmBN,OAAnB;;AAEAa,UAAQC,GAAR,CAAY,GAAZ,EAAgB,KAAKC,IAAL,CAAUC,aAA1B;AACAH,UAAQC,GAAR,CAAY,KAAKG,SAAjB;AACA,EAxEO;AAyER;AACAhB,aAAY,oBAASW,IAAT,EAAcM,QAAd,EAAwB;AACnCL,UAAQC,GAAR,CAAY,OAAZ,EAAqBF,KAAKO,KAA1B,EAAiCP,KAAKQ,MAAtC;AACA,MAAIC,KAAKjD,GAAGkD,WAAH,CAAe,KAAK7C,QAApB,CAAT;AACA,MAAI8C,SAASF,GAAGG,YAAH,CAAgB,eAAhB,CAAb;AACAD,SAAOR,IAAP,GAAc,KAAKA,IAAnB;AACAQ,SAAOvB,OAAP,GAAe,IAAf;AACAuB,SAAOX,IAAP,GAAYA,IAAZ;AACAW,SAAOJ,KAAP,GAAeP,KAAKO,KAApB;AACAI,SAAOH,MAAP,GAAgBR,KAAKQ,MAArB;AACAG,SAAOxB,KAAP,GAAea,KAAKb,KAApB;AACAwB,SAAOL,QAAP,GAAgBA,QAAhB;AACAG,KAAGI,QAAH,CAAY,KAAKxC,SAAjB;AACA;AACA,OAAK8B,IAAL,CAAUW,UAAV,CAAqBC,IAArB,CAA0BJ,MAA1B;AACA,SAAOF,EAAP;AACA,EAzFO;AA0FRO,gBAAe,uBAAShB,IAAT,EAAe;AAC7BC,UAAQC,GAAR,CAAY,SAAZ,EAAuBF,KAAKO,KAA5B,EAAmCP,KAAKQ,MAAxC;AACA,MAAIC,KAAKjD,GAAGkD,WAAH,CAAe,KAAKzC,SAApB,CAAT;AACA,MAAI0C,SAASF,GAAGG,YAAH,CAAgB,OAAhB,CAAb;AACA;AACAD,SAAOJ,KAAP,GAAeP,KAAKO,KAApB;AACAI,SAAOH,MAAP,GAAgBR,KAAKQ,MAArB;AACAG,SAAOxB,KAAP,GAAea,KAAKb,KAApB;AACA;AACA;AACA,SAAOsB,EAAP;AACA,EArGO;AAsGR;AACAQ,iBAAe,wBAASC,GAAT,EAAa;AAC3B,OAAKf,IAAL,CAAUW,UAAV,CAAqB7B,OAArB,CAA6B,UAASC,KAAT,EAAgBC,KAAhB,EAAuB;AACnD,OAAGD,MAAMC,KAAN,IAAa+B,IAAI/B,KAAjB,IAA0BD,MAAMiC,UAAnC,EAA8C;AAC7CjC,UAAMkC,QAAN;AACA;AACD,GAJ4B,CAI3BzB,IAJ2B,CAItB,IAJsB,CAA7B;AAKA,EA7GO;AA8GR;AACAG,aAAW,sBAAU;AACpB,MAAIuB,UAAU,EAAd;AACA;AACA;AACA,MAAIxC,UAAQ,KAAKsB,IAAL,CAAUW,UAAV,CAAqBhC,MAArB,GAA4B,CAAxC;AACA,MAAIC,gBAAc,KAAKC,gBAAL,EAAlB;AACA;AACA,OAAKmB,IAAL,CAAUW,UAAV,CAAqBQ,IAArB,CAA0B,UAASC,CAAT,EAAYC,CAAZ,EAAe;AACxC,UAAOD,EAAEpC,KAAF,GAAUqC,EAAErC,KAAnB;AACA,GAFD;AAGA,MAAIsC,gBAAJ;AACA,MAAIC,eAAJ;AACA;AACA,OAAKvB,IAAL,CAAUW,UAAV,CAAqB7B,OAArB,CAA6B,UAASC,KAAT,EAAgBC,KAAhB,EAAuB;AACnD;AACG,OAAIG,MAAIP,cAAcQ,GAAd,CAAkB/B,GAAGgC,EAAH,CAAM,CAACX,UAAQM,KAAT,IAAgB,KAAKb,WAA3B,EAAuC,CAAvC,CAAlB,CAAR;AACA,OAAGY,MAAMoB,QAAT,EAAkB;AACpBmB,cAASvC,KAAT;AACAwC,aAAOpC,GAAP;AACG,IAHD,MAGK;AACJJ,UAAMN,IAAN,CAAWa,WAAX,CAAuBH,GAAvB;AACA;AACJ,GAT4B,CAS3BK,IAT2B,CAStB,IATsB,CAA7B;AAUA,MAAG8B,OAAH,EAAW;AACV,OAAIE,aAAW,KAAK/C,IAApB;AACA;AACA,QAAKiB,YAAL,CAAkB,YAAW;AAC5B4B,YAAQ7C,IAAR,CAAagD,MAAb,GAAqBD,UAArB;AACAF,YAAQnB,QAAR,GAAiB,KAAjB;AACAmB,YAAQ7C,IAAR,CAAaa,WAAb,CAAyBiC,MAAzB;AACAzB,YAAQC,GAAR,CAAY,KAAKC,IAAL,CAAUW,UAAtB;AACAb,YAAQC,GAAR,CAAYuB,OAAZ,EAAoBC,MAApB;AACC,IANF,EAMI,CANJ;AAOA;AACD,EAjJO;AAkJR;AACAG,iBAAe,wBAASX,GAAT,EAAa;AAC3B,MAAIG,UAAQ,EAAZ;AACA,OAAKlB,IAAL,CAAUW,UAAV,CAAqB7B,OAArB,CAA6B,UAASC,KAAT,EAAeC,KAAf,EAAqB;AACjD,OAAGD,MAAMC,KAAN,IAAe+B,IAAI/B,KAAtB,EAA4B;AAC3BkC,YAAQN,IAAR,CAAa7B,KAAb;AACA;AACD,GAJ4B,CAI3BS,IAJ2B,CAItB,IAJsB,CAA7B;AAKA,OAAKQ,IAAL,CAAUW,UAAV,GAAqBO,OAArB;AACApB,UAAQC,GAAR,CAAY,MAAZ,EAAmB,KAAKC,IAAL,CAAUW,UAA7B;AACAI,MAAItC,IAAJ,CAASkD,OAAT;AACA,EA7JO;AA8JR;AACAC,UAAQ,iBAASb,GAAT,EAAa;AACpBjB,UAAQC,GAAR,CAAY,QAAZ;AACA,MAAI8B,OAAKd,IAAItC,IAAJ,CAASqD,CAAlB;AACA,MAAIC,QAAQ,KAAKlB,aAAL,CAAmBE,IAAIlB,IAAvB,CAAZ;AACAC,UAAQC,GAAR,CAAYgC,KAAZ;AACA;AACAA,QAAMzC,WAAN,CAAkBjC,GAAGgC,EAAH,CAAMwC,IAAN,EAAW,CAAX,CAAlB;AACA;AACA,OAAKH,cAAL,CAAoBX,GAApB;AACA,OAAKtC,IAAL,CAAUc,QAAV,CAAmBwC,KAAnB;AACA;AACA,OAAKrC,YAAL,CAAkB,YAAW;AAC5B;AACAqC,SAAMN,MAAN,GAAc,KAAKO,OAAL,CAAavD,IAA3B;AACAsD,SAAMzC,WAAN,CAAkBjC,GAAGgC,EAAH,CAAM,CAAN,EAAQ,CAAR,CAAlB;AACC,GAJF,EAII,IAJJ;AAKA;AACA,EAhLO;AAiLR;AACA4C,gBAAc,yBAAU,CAEvB,CApLO;AAqLR;AACApD,mBAAiB,4BAAU;AACvB;AACA,MAAIL,QAAM,KAAKC,IAAL,CAAUD,KAApB;AACA;AACA,MAAII,gBAAcvB,GAAGgC,EAAH,CAAMb,QAAM,CAAN,GAAQ,KAAKL,WAAL,GAAiB,CAA/B,CAAlB;AACA,SAAOS,aAAP;AACA;AACD;AA7LK,CAAT","file":"CurrentMj.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["/**\r\n * 我的手里牌列表\r\n */\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n    \t//单个麻将精灵\r\n\t\tMjSprite: {\r\n\t\t\tdefault: null,\r\n\t\t\ttype: cc.Prefab\r\n\t\t},\r\n\t\t //打出去的牌\r\n\t\toutPrefab:{\r\n\t\t\tdefault:null,\r\n\t\t\ttype:cc.Prefab\r\n\t\t},\r\n\t\t//单个麻将宽度\r\n\t\tmajiangWidth: 58,\r\n\t\t//单个麻将高度\r\n\t\tmajiangHeight: 84,\r\n\t\t//麻将间隙，适用于所有横的排列\r\n\t\tmajiangJianxi: 4,\r\n\t\t//是否有新牌\r\n\t\t//hasNewMajiang: false,\r\n\t\t//默认缩放，需要和自己的新牌保持一致\r\n\t\tinitScale: 1.25,\r\n\t\t//手里牌列表\r\n\t\t//shouliList: [],\r\n\t\trealMjWidth:0,\r\n\t\t\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n    \t//计算一下实际牌的宽度,单个麻将实际宽度\r\n    \tthis.realMjWidth=(this.majiangWidth-this.majiangJianxi)*this.initScale;\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n    //初始化手里牌列表,mjs=[{xx:xx}]\r\n    initAllCurrentMj:function(mjs){\r\n    \tlet width=this.node.width;\r\n    \tlet aLength=mjs.length-1;\r\n    \t//最右边一颗\r\n    \tlet fixedPosition=this.getFixedPosition();\r\n    \t//console.log(fixedPosition) \r\n    \tmjs.forEach(function(value,index){\r\n    \t\tlet majiang = this.spawnNewMj(value,false);\r\n    \t\t//从左往右排列\r\n    \t\tlet pos=fixedPosition.sub(cc.v2((aLength-index)*this.realMjWidth,0));\r\n    \t\t//console.log(pos)\r\n    \t\tmajiang.setPosition(pos);\r\n    \t\tthis.node.addChild(majiang);\r\n    \t}.bind(this));\r\n    \t//盖牌\r\n    \t//1秒后排序\r\n    \tthis.scheduleUpdate();\r\n    },\r\n    scheduleUpdate:function(){\r\n    \tthis.scheduleOnce(function() {\r\n\t\t     this.updateSort();\r\n\t\t }, 0.5);\r\n    },\r\n\tgetOne:function(mjzz){\r\n\t\tconsole.log(\"获取新牌\")\r\n\t\tthis.game.hasNewMajiang=true; \r\n\t\tlet majiang = this.spawnNewMj(mjzz,true);\r\n\t\tthis.node.addChild(majiang);\r\n\t\t\r\n\t\tconsole.log(\"新\",this.game.hasNewMajiang);\r\n\t\tconsole.log(this.CurrentMj)\r\n\t},\r\n\t//生成麻将对象\r\n\tspawnNewMj: function(mjzz,isNewOne) {\r\n\t\tconsole.log(\"创建麻将：\", mjzz.huase, mjzz.number)\r\n\t\tvar mj = cc.instantiate(this.MjSprite);\r\n\t\tvar config = mj.getComponent('MajiangEntity');\r\n\t\tconfig.game = this.game;\r\n\t\tconfig.majiang=this;\r\n\t\tconfig.mjzz=mjzz;\r\n\t\tconfig.huase = mjzz.huase;\r\n\t\tconfig.number = mjzz.number;\r\n\t\tconfig.index = mjzz.index;\r\n\t\tconfig.isNewOne=isNewOne;\r\n\t\tmj.setScale(this.initScale);\r\n\t\t//把所有牌放入手头牌列表，即使是新牌，也算是自己的\r\n\t\tthis.game.shouliList.push(config);\r\n\t\treturn mj;\r\n\t},\r\n\tspawnNewOutMj: function(mjzz) {\r\n\t\tconsole.log(\"创建丢弃麻将：\", mjzz.huase, mjzz.number)\r\n\t\tvar mj = cc.instantiate(this.outPrefab);\r\n\t\tvar config = mj.getComponent('OutMj');\r\n\t\t//config.game = this.game;\r\n\t\tconfig.huase = mjzz.huase;\r\n\t\tconfig.number = mjzz.number;\r\n\t\tconfig.index = mjzz.index;\r\n\t\t//mj.setScale(this.initScale);\r\n\t\t//把所有牌放入手头牌列表，即使是新牌，也算是自己的\r\n\t\treturn mj;\r\n\t},\r\n\t//循环调用其他牌的unselecte\r\n\tunSelectOthers:function(ent){\r\n\t\tthis.game.shouliList.forEach(function(value, index) {\r\n\t\t\tif(value.index!=ent.index && value.isSelected){\r\n\t\t\t\tvalue.unSelect();\r\n\t\t\t}\r\n\t\t}.bind(this));\r\n\t},\r\n\t//排序手里牌\r\n\tupdateSort:function(){\r\n\t\tlet newList = [];\r\n\t\t//计算可操作牌的起点位置\r\n\t\t//let aw = this.getAW();\r\n\t\tlet aLength=this.game.shouliList.length-1;\r\n\t\tlet fixedPosition=this.getFixedPosition();\r\n\t\t//新摸的牌已经放到最后一张，所以需要重新排序\r\n\t\tthis.game.shouliList.sort(function(a, b) {\r\n\t\t\treturn a.index - b.index;\r\n\t\t});\r\n\t\tlet newNode;\r\n\t\tlet newPos;\r\n\t\t//循环设置新坐标\r\n\t\tthis.game.shouliList.forEach(function(value, index) {\r\n\t\t\t//从左往右排列\r\n    \t\tlet pos=fixedPosition.sub(cc.v2((aLength-index)*this.realMjWidth,0));\r\n    \t\tif(value.isNewOne){\r\n\t\t\t\tnewNode= value;  \r\n\t\t\t\tnewPos=pos;\r\n    \t\t}else{\r\n    \t\t\tvalue.node.setPosition(pos);\r\n    \t\t}\r\n\t\t}.bind(this));\r\n\t\tif(newNode){\r\n\t\t\tlet parentNode=this.node;\r\n\t\t\t//移动节点，再设置坐标\r\n\t\t\tthis.scheduleOnce(function() {\r\n\t\t\t\tnewNode.node.parent= parentNode;\r\n\t\t\t\tnewNode.isNewOne=false;\r\n\t\t\t\tnewNode.node.setPosition(newPos);\r\n\t\t\t\tconsole.log(this.game.shouliList);\r\n\t\t\t\tconsole.log(newNode,newPos);\r\n\t\t \t}, 1);\r\n\t\t}\r\n\t},\r\n\t//从数组中，把数据先移除\r\n\tremoveFromList:function(ent){\r\n\t\tlet newList=[];\r\n\t\tthis.game.shouliList.forEach(function(value,index){\r\n\t\t\tif(value.index != ent.index){\r\n\t\t\t\tnewList.push(value);\r\n\t\t\t}\r\n\t\t}.bind(this));\r\n\t\tthis.game.shouliList=newList;\r\n\t\tconsole.log(\"移除之后\",this.game.shouliList);\r\n\t\tent.node.destroy();\r\n\t},\r\n\t//打出去一张手里牌，需要把新牌加进来，再排序\r\n\ttakeOut:function(ent){\r\n\t\tconsole.log(\"手里牌打出去\");\r\n\t\tlet posX=ent.node.x;\r\n\t\tlet outMj = this.spawnNewOutMj(ent.mjzz);\r\n\t\tconsole.log(outMj)\r\n\t\t//打出去牌默认位置\r\n\t\toutMj.setPosition(cc.v2(posX,0));\r\n\t\t//把自己从数组中移除\r\n\t\tthis.removeFromList(ent);\r\n\t\tthis.node.addChild(outMj);\r\n\t\t//生成一张丢棋牌,然后飞出去takeOut\r\n\t\tthis.scheduleOnce(function() {\r\n\t\t\t//如果直接转移到垃圾桶\r\n\t\t\toutMj.parent =this.dustbin.node;\r\n\t\t\toutMj.setPosition(cc.v2(0,0));\r\n\t\t }, 0.05);\r\n\t\t//this.dustbin.takeOut(ent.mjzz,pos1,cc.v2(0,0));\r\n\t},\r\n\t//从新牌那边移动过来\r\n\tmoveMjFromNew:function(){\r\n\t\t\r\n\t},\r\n\t//获取固定牌的定位\r\n\tgetFixedPosition:function(){\r\n    \t//手里牌宽度，固定后，不会随牌的数量增减而变化\r\n    \tlet width=this.node.width;\r\n    \t//最右边一颗\r\n    \tlet fixedPosition=cc.v2(width/2-this.realMjWidth/2);\r\n    \treturn fixedPosition;\r\n    }\r\n    // update (dt) {},\r\n});\r\n"]}