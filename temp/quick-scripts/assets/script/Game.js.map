{"version":3,"sources":["Game.js"],"names":["cc","Class","extends","Component","properties","majiangPrefab","default","type","Prefab","takeoutIndex","takeoutScale","initScale","majiangWidth","majiangHeight","majiangJianxi","basicTakeoutY","numbers","btnReady","Button","btnGetOne","duiziCount","duiziWidth","duiziScale","isSingle","majiangIndex","currentMajiang","firstMajiang","shouliList","duiziList","angangList","minggangList","onLoad","console","log","width","Math","floor","node","height","basicWidth","basicHeight","majiangAllWidth","on","begin","mopai","start","update","dt","initAllMajiang","mjzz","mj","spawnNewMj","setScale","getComponent","aw","getAW","setPosition","getNewMjPosition","addChild","getRandomNumbers","initCount","nubArr","i","ent","push","length","sort","a","b","index","config","updateShoulipai","arr","huase","forEach","se","ind","ds","amount","random","number","instantiate","game","isNewOne","randX","randY","v2","getTakeOutPosition","scaleWidth","outNumb","outLevel","parseInt","mjX","mjY","newList","self","value","testGetOne","duigangWidth","unSelectOthers","isSelected","unSelect","setTimeout"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n\textends: cc.Component,\r\n\r\n\tproperties: {\r\n\t\t//麻将实体引用\r\n\t\tmajiangPrefab: {\r\n\t\t\tdefault: null,\r\n\t\t\ttype: cc.Prefab\r\n\t\t},\r\n\t\t//打出去多少张\r\n\t\ttakeoutIndex: 0,\r\n\t\t//打出去缩放比例\r\n\t\ttakeoutScale: 1,\r\n\t\t//初始化缩放比例\n\t\tinitScale: 1.25,\r\n\t\t//单个麻将宽度\r\n\t\tmajiangWidth: 58,\r\n\t\t//单个麻将高度\r\n\t\tmajiangHeight: 84,\r\n\t\t//麻将间隙，适用于所有横的排列\r\n\t\tmajiangJianxi: 4,\r\n\t\t//打出去牌的Y坐标\r\n\t\tbasicTakeoutY: 0,\r\n\t\tnumbers: [],\r\n\t\t//准备按钮\r\n\t\tbtnReady: cc.Button,\r\n\t\t//摸牌按钮\r\n\t\tbtnGetOne: cc.Button,\r\n\t\t//对子组数量\r\n\t\tduiziCount: 0,\r\n\t\t//一组对子的宽度\r\n\t\tduiziWidth: 0,\r\n\t\t//对子缩放比例\r\n\t\tduiziScale: 1,\r\n\t\t//是否只能选择一张\r\n\t\tisSingle:true,\r\n\t\t//麻将索引\r\n\t\tmajiangIndex:0,\r\n\t\t//新摸的一颗\r\n\t\tcurrentMajiang:null,\r\n\t\t//第一颗麻将\r\n\t\tfirstMajiang:null,\r\n\t\t//手头牌列表\r\n\t\tshouliList:[],\r\n\t\t//对子列表\r\n\t\tduiziList:[],\r\n\t\t//暗杠列表\r\n\t\tangangList:[],\r\n\t\t//明杠列表\r\n\t\tminggangList:[]\r\n\r\n\t},\r\n\r\n\t// LIFE-CYCLE CALLBACKS:\r\n\r\n\tonLoad() {\r\n\t\tconsole.log(\"开始游戏，创建对象池\");\r\n\t\t//console.log(this.node)\r\n\t\tlet width = Math.floor(this.node.width);\r\n\t\tlet height = Math.floor(this.node.height);\r\n\t\t//右下角位置点\r\n\t\tthis.basicWidth = -width / 2;\r\n\t\tthis.basicHeight = -height / 2;\r\n\t\tthis.basicTakeoutY = this.basicHeight + this.majiangHeight*this.initScale+40;\r\n\t\tconsole.log(width, height);\r\n\t\t//麻将总长=（麻将宽度-间隙）*13\r\n\t\tthis.majiangAllWidth = (this.majiangWidth*this.initScale - this.majiangJianxi) * 13;\r\n\t\t//计算一组对子(杠)的宽度，三张牌放底下，缩放80%\r\n\t\tthis.duiziWidth = (this.majiangWidth - this.majiangJianxi) * 3 * this.duiziScale;\r\n\t\t//准备按钮绑定事件\r\n\t\tthis.btnReady.node.on('click', this.begin, this);\n\t\t//测试摸牌按钮\r\n\t\tthis.btnGetOne.node.on('click', this.mopai, this);\r\n\t\t\r\n\t},\r\n\r\n\tstart() {\r\n\r\n\t},\r\n\r\n\tupdate(dt) {\r\n\t\t//console.log(\"更新画布\",dt)\r\n\t},\r\n\tbegin: function() {\r\n\t\t//洗牌\r\n\t\tthis.initAllMajiang();\r\n\t\t//显示到屏幕上\r\n\t\t/*let mjSize = this.majiangPool.size();\r\n\t\tconsole.log(\"麻将个数：\" + mjSize);\r\n\t\tfor(var i = 0; i < mjSize; i++) {\r\n\t\t\tlet majiang = this.majiangPool.get();\r\n\t\t\tthis.node.addChild(majiang);\r\n\t\t}*/\r\n\t},\r\n\tmopai:function(){\r\n\t\t//摸一张，放到最右手边，理论上从服务器获得一个号码，测试从本地获取\r\n\t\tlet mjzz = this.numbers[this.majiangIndex];\r\n\t\t\r\n\t\tlet mj = this.spawnNewMj(mjzz);\r\n\t\tmj.setScale(this.initScale);\r\n\t\tthis.currentMajiang = mj.getComponent('MajiangEntity');\r\n\t\tlet aw = this.getAW();\r\n\t\t//设置固定位置\r\n\t\tmj.setPosition(this.getNewMjPosition(13,true,aw));\r\n\t\tthis.node.addChild(mj);\r\n\t\tthis.majiangIndex++;\r\n\t},\r\n\tinitAllMajiang: function() {\r\n\t\tthis.getRandomNumbers();\r\n\t\t//this.majiangPool = new cc.NodePool();\r\n\t\t//this.majiangOutPool = new cc.NodePool();\r\n\t\tlet initCount = 13;\r\n\t\tlet nubArr = [];\r\n\t\tfor(let i = 0; i < initCount; ++i) {\r\n\t\t\tlet ent = this.numbers[i];\r\n\t\t\tnubArr.push(ent);\r\n\t\t\tthis.majiangIndex++;\r\n\t\t}\r\n\t\tconsole.log(nubArr)\r\n\t\tif(nubArr.length > 0) {\r\n\t\t\t//按index排序\r\n\t\t\tnubArr.sort(function(a, b) {\r\n\t\t\t\treturn a.index - b.index;\r\n\t\t\t});\r\n\t\t}\r\n\t\t//let aw = this.getAW();\r\n\t\tfor(let i = 0; i < nubArr.length; ++i) {\r\n\t\t\tlet mjzz = nubArr[i];\r\n\t\t\t//生成一个新麻将\r\n\t\t\tlet mj = this.spawnNewMj(mjzz);\r\n\t\t\tmj.setScale(this.initScale);\r\n\t\t\tvar config = mj.getComponent('MajiangEntity');\r\n\t\t\t//一排，依次排开\r\n\t\t\t//mj.setPosition(this.getNewMjPosition(i,false,0));\r\n\t\t\t//添加到节点上\r\n\t\t\tthis.node.addChild(mj);\r\n\t\t\t//this.majiangPool.put(mj); // 通过 putInPool 接口放入对象池\r\n\t\t\t//if(this.firstMajiang==null){\r\n\t\t\t\t//this.firstMajiang=config;\r\n\t\t\t\t//this.firstMajiang.isFirst=true;\r\n\t\t\t\t//console.log(this.firstMajiang)\r\n\t\t\t//}\r\n\t\t\t//把所有牌放入手头牌列表\r\n\t\t\tthis.shouliList.push(config);\r\n\t\t}\r\n\t\tthis.updateShoulipai();\r\n\t},\r\n\tgetRandomNumbers: function() {\r\n\t\t//产生1-9数字 numbers  ,每个花色36个数字\r\n\t\tvar arr = [];\r\n\t\tvar huase = [\"tiao\", \"tong\", \"wan\"];\r\n\t\tvar index = 0;\r\n\t\t//遍历花色\r\n\t\thuase.forEach(function(se, ind) {\r\n\t\t\t//遍历1-9数字\r\n\t\t\tfor(let ds = 1; ds <= 9; ds++) {\r\n\t\t\t\t//每种产生4张\r\n\t\t\t\tfor(let amount = 0; amount < 4; amount++) {\r\n\t\t\t\t\tarr.push({\r\n\t\t\t\t\t\t\"index\": index,\r\n\t\t\t\t\t\t\"key\": se + \"_\" + ds,\r\n\t\t\t\t\t\t\"huase\": se,\r\n\t\t\t\t\t\t\"number\": ds\r\n\t\t\t\t\t});\r\n\t\t\t\t\tindex++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t//第一次打乱\r\n\t\tarr.sort(function() {\r\n\t\t\treturn 0.5 - Math.random()\r\n\t\t});\r\n\t\t//第二次打乱\r\n\t\tarr.sort(function() {\r\n\t\t\treturn 0.5 - Math.random()\r\n\t\t});\r\n\t\t//console.log(arr);\r\n\t\tthis.numbers = arr;\r\n\t},\r\n\t//生成麻将对象\r\n\tspawnNewMj: function(mjzz) {\r\n\t\tconsole.log(\"创建麻将：\", mjzz.huase, mjzz.number)\r\n\t\tvar mj = cc.instantiate(this.majiangPrefab);\r\n\t\tvar config = mj.getComponent('MajiangEntity');\r\n\t\tconfig.game = this;\r\n\t\tconfig.type = mjzz.huase;\r\n\t\tconfig.number = mjzz.number;\r\n\t\tconfig.index = mjzz.index;\r\n\t\treturn mj;\r\n\t},\r\n\t//获取每个麻将位置\r\n\tgetNewMjPosition: function(index,isNewOne,start) {\r\n\t\t//获取新麻将的位置\r\n\t\tvar randX = start-this.majiangAllWidth / 2 + (index) * (this.majiangWidth*this.initScale - this.majiangJianxi);\r\n\t\tvar randY = this.basicHeight + 70; //-this.node./2;\r\n\t\tconsole.log(\"位置1：\", index, randX, randY);\r\n\t\tif(isNewOne){\r\n\t\t\trandX=randX+20;\r\n\t\t\tconsole.log(\"新牌\")\r\n\t\t\tconsole.log(\"位置2：\", index, randX, randY);\r\n\t\t}\r\n\t\treturn cc.v2(randX, randY);\r\n\t},\r\n\tgetTakeOutPosition: function(node) {\r\n\t\tconsole.log(node)\r\n\t\t//手里牌对象池移除\r\n\t\t//this.majiangPool.put(node);\r\n\t\t//放入打出去的对象池\r\n\t\t//this.majiangOutPool.put(node);\r\n\t\t//this.node.addChild(node);\r\n\t\t//let mjSize = this.majiangPool.size();\r\n\t\t//console.log(\"剩余张数\",mjSize);\r\n\t\tlet scaleWidth = (this.majiangWidth - this.majiangJianxi) * this.takeoutScale;\r\n\t\tlet outNumb = 10;\r\n\t\t//获取打出去的位置\r\n\t\tlet outLevel = parseInt(this.takeoutIndex / outNumb);\r\n\t\t//scaleWidth*10/2+\r\n\t\t//let mjX=this.basicWidth+300+(scaleWidth*(this.takeoutIndex-outLevel*outNumb));\r\n\t\tlet mjX = -outNumb * scaleWidth / 2 + (scaleWidth * (this.takeoutIndex - outLevel * outNumb));\r\n\r\n\t\tlet mjY = this.basicTakeoutY + outLevel * (this.majiangHeight * this.takeoutScale);\r\n\t\tthis.takeoutIndex++;\r\n\t\tconsole.log(\"位置：\", outLevel, mjX, mjY);\r\n\t\t//调用重新排序\r\n\t\treturn cc.v2(mjX, mjY);\r\n\t},\r\n\t//更新手里牌\r\n\tupdateShoulipai:function(ent){\r\n\t\t//更新手里牌http://www.w3school.com.cn/jsref/jsref_splice.asp\r\n\t\tlet newList=[];\r\n\t\tlet self=this;\r\n\t\t//重新整理顺序\r\n\t\tlet aw = this.getAW();\r\n\t\tlet index=0;\r\n\t\tthis.shouliList.forEach(function(value,ind){\r\n\t\t\tif(!ent || value.index != ent.index){\r\n\t\t\t\tif(self.currentMajiang && value.index > self.currentMajiang.index){\r\n\t\t\t\t\t//设置新牌的位置\r\n\t\t\t\t\tself.currentMajiang.node.setPosition(self.getNewMjPosition(index,false,aw));\r\n\t\t\t\t\tnewList.push(self.currentMajiang);\r\n\t\t\t\t\t//清空新牌\r\n\t\t\t\t\tself.currentMajiang=null;\r\n\t\t\t\t\tindex++;\r\n\t\t\t\t}\r\n\t\t\t\t//设置留下来的位置\n\t\t\t\tvalue.node.setPosition(self.getNewMjPosition(index,false,aw));\r\n\t\t\t\tnewList.push(value);\r\n\t\t\t\tindex++;\r\n\t\t\t}\r\n\t\t});\r\n\t\t//如果是最后一张\r\n\t\tif(self.currentMajiang){\r\n\t\t\t//设置新牌的位置\r\n\t\t\tself.currentMajiang.node.setPosition(self.getNewMjPosition(index,false,aw));\r\n\t\t\tnewList.push(self.currentMajiang);\r\n\t\t\t//清空新牌\r\n\t\t\tself.currentMajiang=null;\r\n\t\t}\r\n\t\t\r\n\t\tthis.shouliList=newList;\r\n\t\t//console.log(this.shouliList);\r\n\t\tif(ent){\r\n\t\t\tthis.testGetOne();\r\n\t\t}\r\n\t},\r\n\t//获取麻将排列起点位置\r\n\tgetAW:function(){\r\n\t\tlet duigangWidth=this.duiziWidth;\r\n\t\tlet aw = (this.duiziList.length+this.angangList.length+this.minggangList.length)*(duigangWidth+10)+50;\r\n\t\treturn aw;\r\n\t},\r\n\t//让其他小主坐冷板凳\r\n\tunSelectOthers:function(ent){\r\n\t\t//定缺，平时选择一张\r\n\t\tif(this.isSingle){\r\n\t\t\tthis.shouliList.forEach(function(value,ind){\r\n\t\t\t\tif(value.index!=ent.index && value.isSelected){\r\n\t\t\t\t\tvalue.unSelect();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},testGetOne:function(){\r\n\t\tlet self=this;\r\n\t\t//测试专用，3秒自动摸牌\r\n\t\tsetTimeout(function(){\r\n\t\t\tself.mopai();\r\n\t\t},3000)\r\n\t}\r\n});"]}