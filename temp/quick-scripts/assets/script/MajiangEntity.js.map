{"version":3,"sources":["MajiangEntity.js"],"names":["cc","Class","extends","Component","properties","numberNode","default","type","Node","huase","number","selectDuration","status","isSelected","clickTimer","onLoad","getNumber","node","on","EventType","TOUCH_START","event","TOUCH_END","endTimer","Date","valueOf","onDoubleClick","onClick","setStatus","state","self","getBackground","bgNode","setPosition","v2","setRotation","name","console","log","loader","loadRes","SpriteFrame","err","spriteFrame","sprite","addComponent","Sprite","bind","enabled","unSelect","majiang","unHighlightMj","mjzz","pos","getPosition","add","unSelectOthers","highlightMj","game","hasNewMajiang","takeOut","isNewOne","scheduleUpdate","start","sub"],"mappings":"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","file":"MajiangEntity.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["/**\r\n * 麻将实体\r\n */\r\ncc.Class({\r\n\textends: cc.Component,\r\n\r\n\tproperties: {\r\n\t\t/*bgNode:{\r\n\t\t\tdefault:null,\r\n\t\t\ttype:cc.Node\r\n\t\t},*/\r\n\t\tnumberNode:{\r\n\t\t\tdefault:null,\r\n\t\t\ttype:cc.Node\r\n\t\t},\r\n\t\t//万条筒\r\n\t\thuase: \"\",\r\n\t\t//1-9点数\r\n\t\tnumber: 0,\r\n\t\t//被选中持续时间\r\n\t\tselectDuration: 1,\r\n\t\t//麻将状态，0摸到手，1选中，2对对碰，3明杠，4暗杠，5打出去\r\n\t\tstatus: 0,\r\n\t\tisSelected: false,\r\n\t\t//上一次结束时间，毫秒级\r\n\t\tclickTimer: 0\r\n\t},\r\n\r\n\t// LIFE-CYCLE CALLBACKS:\r\n\tonLoad() {\r\n\t\t//console.log(this.backgroundSprite);\r\n\t\t//添加背景节点\r\n\t\t//this.getBackground();\r\n\t\t//合成实体\r\n\t\tthis.getNumber();\r\n\t\t//设置状态\r\n\t\t//this.setStatus(0);\r\n\t\t// 触摸开始\r\n\t\tthis.node.on(cc.Node.EventType.TOUCH_START, function(event) {\r\n\t\t\t//console.log('Mouse down');\r\n\t\t}, this);\r\n\t\t//触摸结束\r\n\t\tthis.node.on(cc.Node.EventType.TOUCH_END, function(event) {\r\n\t\t\t//console.log('Mouse end');\r\n\t\t\tvar endTimer = (new Date()).valueOf();\r\n\t\t\t//300毫秒以内2次点击，算doubleclick\r\n\t\t\tif(endTimer - this.clickTimer < 500) {\r\n\t\t\t\tthis.onDoubleClick();\r\n\t\t\t} else {\r\n\t\t\t\tthis.onClick();\r\n\t\t\t}\r\n\t\t\tthis.clickTimer=endTimer;\r\n\t\t}, this);\r\n\t},\r\n\t//设置状态\r\n\tsetStatus: function(state) {\r\n\t\tvar self = this;\r\n\t\t//设置背景状态\r\n\t\tif(self.status == 0 || self.status == 1) {\r\n\r\n\t\t}\r\n\t},\r\n\t//添加背景\r\n\tgetBackground: function() {\r\n\t\t//var self = this;\r\n\t\t//console.log(\"开始数字背景\")\r\n\t\t//加载背景图片\r\n\t\t//cc.loader.loadRes('mj_bg', cc.SpriteFrame, function(err, spriteFrame) {\r\n\t\t\t//self.bgNode = new cc.Node('mjBackground');\r\n\t\t\t//let sprite = self.bgNode.addComponent(cc.Sprite)\r\n\t\t\t//给sprite的spriteFrame属性 赋值  \r\n\t\t\t//sprite.spriteFrame = this.backgroundSprite;\r\n\t\t\t//把新的节点追加到self.node节点去。self.node，就是脚本挂载的节点  \r\n\t\t\tthis.bgNode.setPosition(cc.v2(0, 0));\r\n\t\t\tthis.bgNode.setRotation(180);\r\n\t\t\t//self.node.addChild(self.bgNode)\r\n\t\t//});\r\n\t},\r\n\r\n\t//添加数字\r\n\tgetNumber: function() {\r\n\t\t//这里加载assets/resource/123.png文件   \r\n\t\tlet name = this.huase + \"_\" + this.number;\r\n\t\tconsole.log(\"开始数字\", name)\r\n\t\tvar self = this;\r\n\t\t//console.log(this.getPosition())\r\n\t\t//var entityConfig=this.node.getComponent(\"MajiangEntity\");\r\n\t\tcc.loader.loadRes(name, cc.SpriteFrame, function(err, spriteFrame) {\r\n\t\t\t//创建一个新的节点，因为cc.Sprite是组件不能直接挂载到节点上，只能添加到为节点的一个组件  \r\n\t\t\t//self.numbNode = new cc.Node('numberEntity')\r\n\t\t\t//调用新建的node的addComponent函数，会返回一个sprite的对象  \r\n\t\t\tconst sprite = this.numberNode.addComponent(cc.Sprite)\r\n\t\t\t//给sprite的spriteFrame属性 赋值  \r\n\t\t\tsprite.spriteFrame = spriteFrame\r\n\t\t\t//把新的节点追加到self.node节点去。self.node，就是脚本挂载的节点  \r\n\t\t\t//self.numbNode.setPosition(cc.v2(0,12));\r\n\t\t\t//self.numbNode.setPosition(cc.v2(0, -12));\n\t\t\tthis.numberNode.setPosition(cc.v2(0, -12));\r\n\t\t\t//node.setRotation(180);\r\n\t\t\t//self.node.addChild(self.numbNode)\r\n\t\t}.bind(this))\r\n\t},\r\n\t//被选中和释放选中\r\n\tonClick: function() {\r\n\t\tif(!this.enabled){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(this.isSelected) {\r\n\t\t\tthis.unSelect();\r\n\t\t\tthis.majiang.unHighlightMj(this.mjzz);\r\n\t\t} else {\r\n\t\t\tthis.isSelected = true;\r\n\t\t\t//this.bgNode.setRotation(180);\r\n\t\t\t//this.bgNode.setPosition(cc.v2(0, 22));\r\n\t\t\t//this.numbNode.setPosition(cc.v2(0, 12));\r\n\t\t\tlet pos=this.node.getPosition();\r\n\t\t\t//向上移动10像素\r\n\t\t\tthis.node.setPosition(pos.add(cc.v2(0,20)));\r\n\t\t\t//取消其他的选中状态\r\n\t\t\tthis.majiang.unSelectOthers(this);\r\n\t\t\tthis.majiang.highlightMj(this.mjzz);\r\n\t\t}\r\n\t},\r\n\t//双击把自己打出去\r\n\tonDoubleClick: function() {\r\n\t\t//打出去,如果没有摸牌，是打不出去的\r\n\t\tif(!this.game.hasNewMajiang){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.game.hasNewMajiang=false;\r\n\t\tthis.majiang.takeOut(this);\r\n\t\tif(this.isNewOne){\r\n\t\t\t//直接打出去\r\n\t\t}else{\r\n\t\t\t//打出去之后，把新牌拿进来\r\n\t\t\tthis.majiang.scheduleUpdate();\r\n\t\t}\r\n\t\treturn;\r\n\t\t/*this.bgNode.setRotation(0);\r\n\t\tthis.bgNode.setPosition(cc.v2(0, 22));\r\n\t\tthis.numbNode.setPosition(cc.v2(0,32));\r\n\t\t//整体变小\r\n\t\tthis.node.setScale(this.game.takeoutScale);\r\n\t\tconsole.log(\"缩放比例\",this.game.takeoutScale)\r\n\t\t//按照顺序，排列在面前，10张\r\n\t\tthis.node.setPosition(this.game.getTakeOutPosition(this.node));\r\n\t\tthis.enabled = false\r\n\t\tthis.node.off(cc.Node.EventType.TOUCH_START);\r\n\t\tthis.node.off(cc.Node.EventType.TOUCH_END);\r\n\t\t//停止并且移除所有正在运行的动作列表。\r\n        //this.node.stopAllActions();\r\n        //如果自己就是新牌,不会影响原来的顺序\r\n        this.game.removeShoulipai(this);*/\r\n        /*if(this.index != this.game.currentMajiang.index){\n        \tthis.game.updateShoulipai(this);\r\n        }else{\r\n        \tthis.game.testGetOne()\r\n        }*/\r\n\t},\r\n\tstart() {\r\n\r\n\t},\r\n\tunSelect:function(){\r\n\t\tthis.isSelected = false;\r\n\t\tlet pos=this.node.getPosition();\r\n\t\t//向下移动10像素\r\n\t\tthis.node.setPosition(pos.sub(cc.v2(0,20)))\r\n\t}\r\n\r\n\r\n\t// update (dt) {},\r\n});"]}